<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HỆ THỐNG QUẢN TRỊ - SHOP BẮP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f8fafc; }
        .glass-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; }
        .tab-active { background: #3b82f6; color: white; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .btn-approve { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .btn-complete { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .status-badge { padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-10">
        <!-- Dashboard Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
            <div class="flex items-center gap-5">
                <div class="w-16 h-16 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-2xl flex items-center justify-center text-slate-900 shadow-2xl">
                    <i class="fas fa-shield-halved text-3xl"></i>
                </div>
                <div>
                    <h1 class="text-4xl font-black tracking-tight">ADMIN <span class="text-yellow-400">PANEL</span></h1>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mt-1">Hệ thống điều hành Shop Bắp</p>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <nav class="flex bg-slate-900/50 p-1.5 rounded-2xl border border-slate-800">
                <button onclick="switchView('bank')" id="tab-bank" class="tab-active px-8 py-3 rounded-xl text-sm font-black transition-all duration-300">
                    <i class="fas fa-university mr-2"></i>Duyệt Bank
                </button>
                <button onclick="switchView('orders')" id="tab-orders" class="px-8 py-3 rounded-xl text-sm font-black text-slate-400 transition-all duration-300">
                    <i class="fas fa-shopping-bag mr-2"></i>Đơn Dịch Vụ
                </button>
            </nav>
        </header>

        <!-- Statistics Quick View -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
            <div class="glass-card p-5 border-l-4 border-yellow-500">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">Yêu cầu nạp</p>
                <h3 id="stat-bank" class="text-3xl font-black">0</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-blue-500">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">Đơn đang chờ</p>
                <h3 id="stat-orders" class="text-3xl font-black text-blue-400">0</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-emerald-500">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">Tổng hoàn tất</p>
                <h3 id="stat-done" class="text-3xl font-black text-emerald-400">0</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-slate-700">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">Máy chủ</p>
                <h3 class="text-sm font-black text-emerald-500 uppercase flex items-center gap-2 mt-2">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> Hoạt động
                </h3>
            </div>
        </div>

        <!-- Main Workspace -->
        <main>
            <!-- Bank Section -->
            <div id="view-bank" class="space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-black flex items-center gap-3 italic"><i class="fas fa-money-bill-transfer text-emerald-400"></i> DUYỆT NẠP TIỀN BANK</h2>
                    <span class="text-[10px] bg-emerald-500/10 text-emerald-400 px-3 py-1 rounded-full font-bold">REALTIME</span>
                </div>
                <div id="list-bank" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 text-slate-500 italic">
                    Đang tải dữ liệu ngân hàng...
                </div>
            </div>

            <!-- Orders Section -->
            <div id="view-orders" class="space-y-6 hidden">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-black flex items-center gap-3 italic"><i class="fas fa-boxes-packing text-blue-400"></i> ĐƠN HÀNG DỊCH VỤ</h2>
                    <span class="text-[10px] bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full font-bold">XỬ LÝ NGAY</span>
                </div>
                <div id="list-orders" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 text-slate-500 italic">
                    Đang quét danh sách đơn hàng...
                </div>
            </div>
        </main>
    </div>

    <!-- Notification system -->
    <div id="notify" class="fixed bottom-10 right-10 translate-y-32 opacity-0 transition-all duration-500 z-50">
        <div class="bg-white text-slate-900 px-8 py-4 rounded-2xl shadow-2xl font-black flex items-center gap-4">
            <i class="fas fa-check-circle text-emerald-500 text-xl"></i>
            <span id="notify-msg">Thành công!</span>
        </div>
    </div>

    <script>
        // Cấu hình Firebase - Giữ nguyên Database của bạn
        const firebaseConfig = { databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Chuyển đổi giao diện
        function switchView(view) {
            document.getElementById('view-bank').classList.toggle('hidden', view !== 'bank');
            document.getElementById('view-orders').classList.toggle('hidden', view !== 'orders');
            document.getElementById('tab-bank').className = (view === 'bank' ? 'tab-active' : '') + ' px-8 py-3 rounded-xl text-sm font-black transition-all duration-300';
            document.getElementById('tab-orders').className = (view === 'orders' ? 'tab-active' : '') + ' px-8 py-3 rounded-xl text-sm font-black transition-all duration-300';
        }

        // --- 1. Xử lý Nạp Bank ---
        db.ref('requests').on('value', snapshot => {
            const container = document.getElementById('list-bank');
            const data = snapshot.val();
            let count = 0;
            container.innerHTML = "";

            if(!data) {
                container.innerHTML = `<div class="col-span-full glass-card p-12 text-center text-slate-600 font-bold uppercase tracking-widest">Không có yêu cầu nạp tiền</div>`;
                document.getElementById('stat-bank').innerText = 0;
                return;
            }

            Object.keys(data).forEach(key => {
                count++;
                const item = data[key];
                container.innerHTML += `
                    <div class="glass-card p-6 border-t-2 border-emerald-500 shadow-xl">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h4 class="text-white font-black text-lg">@${item.user}</h4>
                                <p class="text-[10px] text-slate-500 font-bold">${item.time}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-emerald-400 font-black text-xl">+${item.amount.toLocaleString()}đ</p>
                                <p class="text-[9px] text-slate-600 font-bold uppercase mt-1">Nội dung: ${item.memo || 'Trống'}</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <button onclick="approveBank('${item.user}', ${item.amount}, '${key}')" class="w-full btn-approve text-white font-black py-3 rounded-xl shadow-lg active:scale-95 transition-all">DUYỆT TIỀN</button>
                            <button onclick="rejectReq('${key}')" class="w-full text-[10px] font-bold text-slate-600 hover:text-red-400 py-2 transition-colors uppercase">Hủy & Xóa yêu cầu</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('stat-bank').innerText = count;
        });

        async function approveBank(user, amount, key) {
            if(!confirm(`Xác nhận cộng ${amount.toLocaleString()}đ cho ${user}?`)) return;
            
            const userRef = db.ref('users/' + user);
            const userSnap = await userRef.get();
            const currentBalance = (userSnap.val()?.balance) || 0;

            await userRef.update({ balance: currentBalance + amount });
            await db.ref('requests/' + key).remove();
            showNotify(`Đã nạp ${amount.toLocaleString()}đ cho @${user}`);
        }

        function rejectReq(key) { if(confirm("Xóa yêu cầu nạp này?")) db.ref('requests/' + key).remove(); }

        // --- 2. Xử lý Đơn Hàng ---
        db.ref('orders').on('value', snapshot => {
            const container = document.getElementById('list-orders');
            const data = snapshot.val();
            let pending = 0;
            let done = 0;
            container.innerHTML = "";

            if(!data) {
                container.innerHTML = `<div class="col-span-full glass-card p-12 text-center text-slate-600 font-bold uppercase tracking-widest">Hiện không có đơn hàng nào</div>`;
                document.getElementById('stat-orders').innerText = 0;
                return;
            }

            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                if(item.status === 'Đang xử lý') {
                    pending++;
                    container.innerHTML += `
                        <div class="glass-card p-6 border-t-2 border-blue-500 shadow-xl">
                            <div class="flex justify-between mb-4">
                                <span class="bg-blue-500/10 text-blue-400 px-2 py-1 rounded-md text-[10px] font-black uppercase">${item.item}</span>
                                <span class="text-[10px] text-slate-600 font-bold">${item.time}</span>
                            </div>
                            <p class="text-sm font-bold text-slate-400 mb-4">Khách hàng: <span class="text-white">@${item.user}</span></p>
                            
                            <div class="bg-black/40 p-4 rounded-xl border border-slate-800 mb-6 group relative">
                                <p class="text-[9px] text-slate-600 font-bold uppercase mb-2 italic">Thông tin ACC:</p>
                                <p id="txt-${key}" class="text-xs font-mono text-blue-300 break-all">${item.info}</p>
                                <button onclick="copyTxt('${key}')" class="absolute top-3 right-3 text-slate-700 hover:text-white transition-colors">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>

                            <div class="grid grid-cols-4 gap-2">
                                <button onclick="doneOrder('${key}')" class="col-span-3 btn-complete text-white font-black py-3 rounded-xl shadow-lg active:scale-95 transition-all">HOÀN TẤT ĐƠN ✅</button>
                                <button onclick="delOrder('${key}')" class="bg-slate-800 hover:bg-red-900/40 text-slate-500 rounded-xl transition-all">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    done++;
                }
            });
            document.getElementById('stat-orders').innerText = pending;
            document.getElementById('stat-done').innerText = done;
        });

        async function doneOrder(key) {
            if(confirm("Xác nhận đã xử lý xong đơn hàng này?")) {
                await db.ref('orders/' + key).update({ status: 'Hoàn thành' });
                showNotify("Đã chuyển trạng thái: HOÀN THÀNH");
            }
        }

        function delOrder(key) { if(confirm("Xóa vĩnh viễn đơn hàng này?")) db.ref('orders/' + key).remove(); }

        // Công cụ
        function showNotify(msg) {
            const toast = document.getElementById('notify');
            document.getElementById('notify-msg').innerText = msg;
            toast.classList.remove('translate-y-32', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-32', 'opacity-0'), 3000);
        }

        function copyTxt(key) {
            const text = document.getElementById('txt-' + key).innerText;
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showNotify("Đã copy thông tin ACC!");
        }
    </script>
</body>
</html>
