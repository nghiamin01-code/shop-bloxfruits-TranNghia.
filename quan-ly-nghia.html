<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ADMIN - QU·∫¢N L√ù SHOP B·∫ÆP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { background: #0b1120; color: white; font-family: sans-serif; padding: 20px; }
        .card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        th { text-align: left; color: #facc15; font-size: 12px; text-transform: uppercase; padding: 10px; }
        td { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        .btn-check { background: #22c55e; color: black; padding: 5px 10px; border-radius: 5px; font-weight: bold; font-size: 12px; }
        .btn-del { background: #ef4444; color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; }
    </style>
</head>
<body>
    <h1 class="text-2xl font-bold mb-6 text-yellow-400">TRANG QU·∫¢N TR·ªä ADMIN - NGHƒ®A</h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="card">
            <h2 class="text-blue-400 font-bold mb-4 italic">üí∞ Y√äU C·∫¶U N·∫†P TI·ªÄN</h2>
            <table class="w-full">
                <thead><tr><th>Kh√°ch</th><th>Lo·∫°i</th><th>S·ªë ti·ªÅn n·∫°p</th><th>Th·∫ª(PIN/Seri)</th><th>Duy·ªát</th></tr></thead>
                <tbody id="list-recharge"></tbody>
            </table>
        </div>

        <div class="card">
            <h2 class="text-green-400 font-bold mb-4 italic">üì¶ ƒê∆†N H√ÄNG CH·ªú X·ª¨ L√ù</h2>
            <table class="w-full">
                <thead><tr><th>Kh√°ch</th><th>M√≥n ƒë·ªì</th><th>Acc/Pass/Info</th><th>Duy·ªát</th></tr></thead>
                <tbody id="list-orders"></tbody>
            </table>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. HI·ªÇN TH·ªä DANH S√ÅCH N·∫†P
        db.ref('recharges').on('value', s => {
            let html = '';
            s.forEach(item => {
                const r = item.val();
                html += `<tr>
                    <td><b>${r.user}</b></td>
                    <td>${r.type}</td>
                    <td><input type="number" id="amt-${item.key}" value="${r.amount}" class="bg-black text-white w-20 p-1 border border-white/20"></td>
                    <td>${r.pin ? r.pin+'<br>'+r.seri : 'Bank'}</td>
                    <td><button onclick="approveRecharge('${item.key}', '${r.user}')" class="btn-check">DUY·ªÜT ‚úÖ</button></td>
                </tr>`;
            });
            document.getElementById('list-recharge').innerHTML = html;
        });

        // 2. HI·ªÇN TH·ªä DANH S√ÅCH ƒê∆†N H√ÄNG
        db.ref('orders').on('value', s => {
            let html = '';
            s.forEach(item => {
                const o = item.val();
                html += `<tr>
                    <td><b>${o.user}</b></td>
                    <td>${o.item}</td>
                    <td><span class="text-xs">${o.info}</span></td>
                    <td><button onclick="db.ref('orders/${item.key}').remove()" class="btn-check" style="background:#3b82f6;color:white">XONG ‚úÖ</button></td>
                </tr>`;
            });
            document.getElementById('list-orders').innerHTML = html;
        });

        // H√ÄM DUY·ªÜT N·∫†P TI·ªÄN - T·ª∞ ƒê·ªòNG C·ªòNG
        async function approveRecharge(key, username) {
            const amountToAdd = parseInt(document.getElementById('amt-'+key).value);
            const userRef = db.ref('accounts/' + username);
            
            const snap = await userRef.once('value');
            if(snap.exists()) {
                const currentBalance = snap.val().balance || 0;
                const newBalance = currentBalance + amountToAdd;
                
                // C·∫≠p nh·∫≠t ti·ªÅn m·ªõi cho kh√°ch
                await userRef.update({ balance: newBalance });
                // X√≥a y√™u c·∫ßu n·∫°p sau khi duy·ªát xong
                await db.ref('recharges/' + key).remove();
                
                alert(`ƒê√£ c·ªông ${amountToAdd}ƒë cho ${username}. S·ªë d∆∞ m·ªõi: ${newBalance}ƒë`);
            } else {
                alert("Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n kh√°ch n√†y!");
            }
        }
    </script>
</body>
</html>
