<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8"><title>ADMIN - BAP SHOP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body class="bg-slate-900 text-white p-8">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-4xl font-black text-red-500 mb-12 uppercase italic text-center tracking-tighter">H·ªá Th·ªëng Qu·∫£n Tr·ªã Nghƒ©a</h1>
        <div class="grid md:grid-cols-2 gap-10">
            <div class="bg-slate-800 p-8 rounded-[2.5rem] border border-slate-700 shadow-2xl">
                <h2 class="font-black text-green-400 mb-6 uppercase tracking-widest">üí∞ Duy·ªát Bank</h2>
                <div id="bank-list" class="space-y-4"></div>
            </div>
            <div class="bg-slate-800 p-8 rounded-[2.5rem] border border-slate-700 shadow-2xl">
                <h2 class="font-black text-blue-400 mb-6 uppercase tracking-widest">üõí ƒê∆°n H√†ng M·ªõi</h2>
                <div id="order-list" class="space-y-4"></div>
            </div>
        </div>
    </div>
    <script>
        firebase.initializeApp({ databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com" });
        const db = firebase.database();

        // X·ª≠ l√Ω Bank
        db.ref('nap_bank').on('value', snap => {
            let h = ""; snap.forEach(c => {
                const d = c.val(); if(d.status === "Ch·ªù duy·ªát") {
                    h += `<div class="bg-slate-700 p-5 rounded-2xl flex justify-between items-center">
                        <div><p class="font-black uppercase text-sm">${d.username}</p><p class="text-green-400 font-bold">+${d.amount.toLocaleString()}ƒë</p></div>
                        <button onclick="duyetBank('${c.key}','${d.uid}',${d.amount})" class="bg-green-600 px-5 py-2 rounded-xl font-black text-[10px]">C·ªòNG TI·ªÄN</button>
                    </div>`;
                }
            }); document.getElementById('bank-list').innerHTML = h || "Ch∆∞a c√≥ y√™u c·∫ßu";
        });

        async function duyetBank(k, u, a) {
            if(!confirm("X√°c nh·∫≠n c·ªông ti·ªÅn?")) return;
            const s = await db.ref('users/'+u+'/balance').get();
            await db.ref('users/'+u).update({ balance: (s.val() || 0) + a });
            await db.ref('nap_bank/'+k).update({ status: "Xong" });
            alert("ƒê√£ c·ªông ti·ªÅn th√†nh c√¥ng!");
        }

        // X·ª≠ l√Ω ƒê∆°n mua
        db.ref('orders').on('value', snap => {
            let h = ""; snap.forEach(c => {
                const d = c.val(); if(d.status === "ƒêang ch·ªù") {
                    h += `<div class="bg-slate-700 p-5 rounded-2xl flex justify-between items-center">
                        <div><p class="font-black uppercase text-xs">${d.prod}</p><p class="text-[10px] text-slate-400 italic">${d.user}</p></div>
                        <button onclick="db.ref('orders/${c.key}').update({status:'Ho√†n th√†nh'})" class="bg-blue-600 px-5 py-2 rounded-xl font-black text-[10px]">GIAO XONG</button>
                    </div>`;
                }
            }); document.getElementById('order-list').innerHTML = h || "ƒê∆°n tr·ªëng";
        });
    </script>
</body>
</html>
