<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8"><title>QU·∫¢N TR·ªä BAP SHOP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap');
        body { background: #0f172a; font-family: 'Outfit', sans-serif; color: white; padding: 20px; }
        .admin-card { background: #1e293b; border-radius: 20px; padding: 20px; margin-bottom: 25px; border: 1px solid #334155; }
        .btn-bank { background: #10b981; color: white; padding: 8px 16px; font-weight: 800; border-radius: 10px; transition: 0.3s; }
        .btn-order { background: #3b82f6; color: white; padding: 8px 16px; font-weight: 800; border-radius: 10px; transition: 0.3s; }
        .btn-bank:hover, .btn-order:hover { transform: scale(1.05); filter: brightness(1.2); }
    </style>
</head>
<body>
    <div class="max-w-5xl mx-auto">
        <h1 class="text-3xl font-black text-red-500 mb-10 italic uppercase text-center">BAP SHOP - H·ªÜ TH·ªêNG QU·∫¢N TR·ªä</h1>

        <div class="admin-card">
            <h2 class="text-xl font-black mb-6 text-green-400 border-b border-slate-700 pb-2 flex items-center gap-2">
                üí≥ DUY·ªÜT N·∫†P TI·ªÄN (AGRIBANK)
            </h2>
            <div id="bank-list" class="space-y-4 text-sm">
                </div>
        </div>

        <div class="admin-card">
            <h2 class="text-xl font-black mb-6 text-blue-400 border-b border-slate-700 pb-2 flex items-center gap-2">
                üì¶ ƒê∆†N H√ÄNG C·∫¶N GIAO (CHECK MK TR√äN DISCORD)
            </h2>
            <div id="order-list" class="space-y-4 text-sm">
                </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- X·ª¨ L√ù DUY·ªÜT BANK (T·ª∞ C·ªòNG TI·ªÄN) ---
        db.ref('nap_bank').on('value', (snapshot) => {
            const list = document.getElementById('bank-list');
            list.innerHTML = "";
            snapshot.forEach((item) => {
                const data = item.val();
                if(data.status === "Ch·ªù duy·ªát") {
                    list.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-800 p-4 rounded-xl border border-slate-700">
                        <div>
                            <p class="font-bold text-white uppercase">${data.username}</p>
                            <p class="text-green-400 font-black">+${data.amount.toLocaleString()}ƒë</p>
                        </div>
                        <button onclick="approveBank('${item.key}', '${data.uid}', ${data.amount})" class="btn-bank">DUY·ªÜT TI·ªÄN</button>
                    </div>`;
                }
            });
        });

        async function approveBank(key, uid, amount) {
            if(confirm("B·∫•m 'OK' ƒë·ªÉ h·ªá th·ªëng T·ª∞ C·ªòNG "+amount.toLocaleString()+"ƒë cho kh√°ch?")) {
                const userRef = db.ref('users/' + uid + '/balance');
                const s = await userRef.get();
                const newBalance = (s.val() || 0) + amount;
                await userRef.set(newBalance);
                await db.ref('nap_bank/' + key).update({ status: "Xong" });
                alert("ƒê√£ c·ªông ti·ªÅn th√†nh c√¥ng!");
            }
        }

        // --- X·ª¨ L√ù TR·∫†NG TH√ÅI ƒê∆†N H√ÄNG ---
        db.ref('orders').on('value', (snapshot) => {
            const list = document.getElementById('order-list');
            list.innerHTML = "";
            snapshot.forEach((item) => {
                const data = item.val();
                if(data.status === "ƒêang ch·ªù") {
                    list.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-800 p-4 rounded-xl border border-slate-700">
                        <div>
                            <p class="text-[10px] text-slate-500 font-mono">ID: #${item.key.substring(1,7).toUpperCase()}</p>
                            <p class="font-black text-white uppercase">${data.product}</p>
                            <p class="text-blue-400 font-bold italic">T√†i kho·∫£n: ${data.acc}</p>
                        </div>
                        <button onclick="doneOrder('${item.key}')" class="btn-order">GIAO XONG</button>
                    </div>`;
                }
            });
        });

        async function doneOrder(key) {
            if(confirm("B·∫°n ƒë√£ l√†m ƒë∆°n xong? B·∫•m OK ƒë·ªÉ kh√°ch th·∫•y tr·∫°ng th√°i 'Ho√†n th√†nh'")) {
                await db.ref('orders/' + key).update({ status: "Ho√†n th√†nh" });
                alert("ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n!");
            }
        }
    </script>
</body>
</html>
