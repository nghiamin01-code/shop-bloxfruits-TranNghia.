<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Của Nghĩa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { background: #020617; font-family: 'Orbitron', sans-serif; color: white; }
        .admin-box { background: rgba(30, 41, 59, 0.8); border: 2px solid #ef4444; border-radius: 20px; box-shadow: 0 0 30px rgba(239, 68, 68, 0.2); }
        .tab-btn { padding: 12px 24px; font-weight: 900; transition: 0.3s; border-radius: 10px; font-size: 12px; }
        .active { background: #ef4444; color: black; box-shadow: 0 0 15px #ef4444; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { color: #94a3b8; font-size: 11px; padding: 15px; border-bottom: 2px solid #334155; text-align: left; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #1e293b; font-size: 13px; }
        .btn-approve { background: #22c55e; color: white; padding: 6px 12px; border-radius: 6px; font-weight: bold; font-size: 10px; }
        .btn-delete { background: #ef4444; color: white; padding: 6px 12px; border-radius: 6px; font-weight: bold; font-size: 10px; margin-left: 5px; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-4xl font-black text-red-500 italic italic">QUẢN LÝ NGHĨA</h1>
                <p class="text-gray-400 text-xs">Hệ thống duyệt đơn & cộng tiền tự động</p>
            </div>
            <div class="flex gap-4">
                <button onclick="switchTab('bank')" id="btnBank" class="tab-btn active">DUYỆT NẠP BANK</button>
                <button onclick="switchTab('cay')" id="btnCay" class="tab-btn border border-gray-600">DUYỆT CÀY THUÊ</button>
            </div>
        </div>

        <div id="tabBankContent" class="admin-box p-8">
            <h2 class="text-xl font-bold text-blue-400 mb-4 uppercase">Đơn nạp bank đang chờ</h2>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                        <tr>
                            <th>Tên Khách</th>
                            <th>Số tiền</th>
                            <th>Nội dung</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="list-bank">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="tabCayContent" class="admin-box p-8 hidden">
            <h2 class="text-xl font-bold text-yellow-500 mb-4 uppercase">Đơn cày thuê đang chờ</h2>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                        <tr>
                            <th>Dịch vụ</th>
                            <th>Tài khoản</th>
                            <th>Mật khẩu</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="list-cay">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Hàm chuyển tab
        function switchTab(tab) {
            if(tab === 'bank') {
                document.getElementById('tabBankContent').classList.remove('hidden');
                document.getElementById('tabCayContent').classList.add('hidden');
                document.getElementById('btnBank').classList.add('active');
                document.getElementById('btnCay').classList.remove('active');
            } else {
                document.getElementById('tabBankContent').classList.add('hidden');
                document.getElementById('tabCayContent').classList.remove('hidden');
                document.getElementById('btnBank').classList.remove('active');
                document.getElementById('btnCay').classList.add('active');
            }
        }

        // --- HÀM TẢI DỮ LIỆU TỪ SHOP ---
        function loadData() {
            const bankOrders = JSON.parse(localStorage.getItem('nghia_bank_orders')) || [];
            const cayOrders = JSON.parse(localStorage.getItem('nghia_cay_orders')) || [];
            let currentBalance = parseInt(localStorage.getItem('nghia_balance')) || 0;

            // Hiển thị danh sách Bank
            const bankTable = document.getElementById('list-bank');
            bankTable.innerHTML = bankOrders.length ? bankOrders.map((o, i) => `
                <tr>
                    <td class="font-bold">${o.name}</td>
                    <td class="text-green-400 font-bold">${o.amount.toLocaleString()}đ</td>
                    <td class="text-gray-400">${o.content}</td>
                    <td>
                        <button onclick="approveBank(${i})" class="btn-approve">DUYỆT & CỘNG TIỀN</button>
                        <button onclick="deleteOrder(${i}, 'bank')" class="btn-delete">XÓA</button>
                    </td>
                </tr>
            `).join('') : '<tr><td colspan="4" class="text-center py-10 text-gray-500">Không có đơn nạp bank...</td></tr>';

            // Hiển thị danh sách Cày thuê
            const cayTable = document.getElementById('list-cay');
            cayTable.innerHTML = cayOrders.length ? cayOrders.map((o, i) => `
                <tr>
                    <td class="text-yellow-400 font-bold">${o.service}</td>
                    <td>${o.acc}</td>
                    <td>${o.pass}</td>
                    <td><span class="text-orange-500 italic">Đang chờ</span></td>
                    <td>
                        <button onclick="completeCay(${i})" class="btn-approve">XONG</button>
                        <button onclick="deleteOrder(${i}, 'cay')" class="btn-delete">HỦY</button>
                    </td>
                </tr>
            `).join('') : '<tr><td colspan="5" class="text-center py-10 text-gray-500">Không có đơn cày thuê...</td></tr>';
        }

        // --- HÀM DUYỆT BANK (CỘNG TIỀN THẬT) ---
        function approveBank(index) {
            let bankOrders = JSON.parse(localStorage.getItem('nghia_bank_orders')) || [];
            let currentBalance = parseInt(localStorage.getItem('nghia_balance')) || 0;

            // Cộng tiền vào ví
            currentBalance += bankOrders[index].amount;
            localStorage.setItem('nghia_balance', currentBalance);

            // Xóa đơn đã duyệt
            bankOrders.splice(index, 1);
            localStorage.setItem('nghia_bank_orders', JSON.stringify(bankOrders));

            alert("Đã duyệt! Tiền đã được cộng vào ví khách hàng trên shop.");
            loadData();
        }

        function completeCay(index) {
            let cayOrders = JSON.parse(localStorage.getItem('nghia_cay_orders')) || [];
            cayOrders.splice(index, 1);
            localStorage.setItem('nghia_cay_orders', JSON.stringify(cayOrders));
            alert("Đã hoàn thành đơn cày thuê cho khách!");
            loadData();
        }

        function deleteOrder(index, type) {
            if(confirm("Xóa đơn này?")) {
                let key = type === 'bank' ? 'nghia_bank_orders' : 'nghia_cay_orders';
                let orders = JSON.parse(localStorage.getItem(key));
                orders.splice(index, 1);
                localStorage.setItem(key, JSON.stringify(orders));
                loadData();
            }
        }

        // Tự động load khi mở trang
        loadData();
        // Cập nhật dữ liệu mỗi 2 giây (để khách nạp là thấy ngay)
        setInterval(loadData, 2000);
    </script>
</body>
</html>
