<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Nghĩa Admin - Quản Lý Bank & Đơn</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white p-6 font-sans">
    <h1 class="text-2xl font-black text-red-500 mb-6 uppercase italic">Trình quản lý của Nghĩa</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-slate-800 p-5 rounded-2xl border border-blue-500">
            <h2 class="text-blue-400 font-bold mb-4 uppercase italic">Duyệt Tiền Bank (Làm thủ công)</h2>
            <div id="bank-list" class="space-y-3"></div>
        </div>

        <div class="bg-slate-800 p-5 rounded-2xl border border-green-500">
            <h2 class="text-green-400 font-bold mb-4 uppercase italic">Đơn Cày Thuê (Theo dõi)</h2>
            <div id="work-list" class="space-y-3 text-xs"></div>
        </div>
    </div>

    <script>
        function renderAdmin() {
            const banks = JSON.parse(localStorage.getItem('nghia_pending_bank')) || [];
            const works = JSON.parse(localStorage.getItem('nghia_work')) || [];

            // Hiển thị đơn Bank để Nghĩa duyệt
            document.getElementById('bank-list').innerHTML = banks.map((b, i) => `
                <div class="bg-black/40 p-3 rounded-lg flex justify-between items-center border border-white/5">
                    <div>
                        <p class="font-bold text-yellow-500">${b.u}</p>
                        <p class="text-xs">Chuyển: ${b.v.toLocaleString()}đ</p>
                    </div>
                    <button onclick="approveBank(${i})" class="bg-blue-600 px-3 py-1 rounded text-[10px] font-bold">XÁC NHẬN ĐÃ NHẬN TIỀN</button>
                </div>
            `).join('') || 'Chưa có đơn bank nào.';

            // Hiển thị đơn cày để Nghĩa biết mà làm
            document.getElementById('work-list').innerHTML = works.map((w, i) => `
                <div class="bg-black/40 p-3 rounded-lg border border-white/5 ${w.status === 'Xong' ? 'opacity-50' : ''}">
                    <p class="font-bold text-green-400">${w.s}</p>
                    <p>Khách: ${w.u} | TK: ${w.acc} | MK: ${w.pass}</p>
                    ${w.status !== 'Xong' ? `<button onclick="doneWork(${i})" class="mt-2 bg-green-600 w-full py-1 rounded">BẤM KHI CÀY XONG</button>` : '<p class="text-center text-gray-500 mt-2 font-bold">ĐÃ XONG</p>'}
                </div>
            `).join('') || 'Chưa có đơn cày thuê.';
        }

        function approveBank(i) {
            let banks = JSON.parse(localStorage.getItem('nghia_pending_bank'));
            let db = JSON.parse(localStorage.getItem('nghia_db'));
            
            if(db[banks[i].u]) {
                db[banks[i].u].b += banks[i].v; // Cộng 100% tiền bank
                localStorage.setItem('nghia_db', JSON.stringify(db));
                alert("Đã cộng tiền cho " + banks[i].u);
                banks.splice(i, 1);
                localStorage.setItem('nghia_pending_bank', JSON.stringify(banks));
                renderAdmin();
            }
        }

        function doneWork(i) {
            let works = JSON.parse(localStorage.getItem('nghia_work'));
            works[i].status = 'Xong';
            localStorage.setItem('nghia_work', JSON.stringify(works));
            renderAdmin();
        }

        renderAdmin();
        setInterval(renderAdmin, 5000);
    </script>
</body>
</html>
