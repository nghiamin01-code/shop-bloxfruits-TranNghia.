<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>QU·∫¢N TR·ªä BAP SHOP - ADMIN NGHƒ®A</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap');
        body { background: #0f172a; font-family: 'Outfit', sans-serif; color: white; padding: 20px; }
        .admin-card { background: #1e293b; border-radius: 20px; padding: 20px; margin-bottom: 20px; border: 1px solid #334155; }
        .btn-action { transition: 0.3s; font-weight: 800; text-transform: uppercase; font-size: 12px; }
        .btn-action:hover { transform: translateY(-2px); filter: brightness(1.2); }
    </style>
</head>
<body>
    <div class="max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-10">
            <h1 class="text-3xl font-black italic text-red-500">BAP SHOP ADMIN</h1>
            <div class="bg-slate-800 px-4 py-2 rounded-xl border border-slate-700">
                <p class="text-[10px] text-slate-400">Tr·∫°ng th√°i h·ªá th·ªëng</p>
                <p class="text-green-400 font-bold">‚óè ƒêang ho·∫°t ƒë·ªông</p>
            </div>
        </div>

        <div class="admin-card">
            <h2 class="text-blue-400 font-black mb-4 flex items-center gap-2 text-xl">
                üí≥ DUY·ªÜT BANK <span class="text-[10px] bg-blue-500/20 px-2 py-1 rounded text-blue-300">T·ª± c·ªông ti·ªÅn</span>
            </h2>
            <div id="bank-list" class="space-y-3">
                </div>
        </div>

        <div class="admin-card">
            <h2 class="text-yellow-400 font-black mb-4 flex items-center gap-2 text-xl">
                üì¶ QU·∫¢N L√ù ƒê∆†N H√ÄNG <span class="text-[10px] bg-yellow-500/20 px-2 py-1 rounded text-yellow-300">ƒê·ªïi tr·∫°ng th√°i</span>
            </h2>
            <div id="order-list" class="space-y-3">
                </div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh Firebase
        const firebaseConfig = { 
            databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- X·ª¨ L√ù DUY·ªÜT BANK ---
        db.ref('nap_bank').on('value', (s) => {
            const list = document.getElementById('bank-list');
            list.innerHTML = "";
            if(!s.exists()) { list.innerHTML = "<p class='text-slate-500 italic'>Ch∆∞a c√≥ ƒë∆°n n·∫°p n√†o...</p>"; return; }
            
            s.forEach((item) => {
                const d = item.val();
                if(d.status === "Ch·ªù duy·ªát") {
                    list.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
                        <div>
                            <p class="font-black text-white uppercase">${d.username}</p>
                            <p class="text-green-400 font-black text-lg">${d.amount.toLocaleString()}ƒë</p>
                        </div>
                        <button onclick="approveBank('${item.key}', '${d.uid}', ${d.amount})" class="btn-action bg-green-600 px-6 py-3 rounded-xl shadow-lg shadow-green-900/20">Duy·ªát Ti·ªÅn</button>
                    </div>`;
                }
            });
        });

        async function approveBank(key, uid, amount) {
            if(confirm("C·ªông " + amount.toLocaleString() + "ƒë v√†o v√≠ kh√°ch?")) {
                const userRef = db.ref('users/' + uid + '/balance');
                const snap = await userRef.get();
                const newBalance = (snap.val() || 0) + amount;
                await userRef.set(newBalance);
                await db.ref('nap_bank/' + key).update({ status: "Ho√†n t·∫•t" });
                alert("ƒê√£ c·ªông ti·ªÅn xong!");
            }
        }

        // --- X·ª¨ L√ù ƒê∆†N H√ÄNG (S·∫£n ph·∫©m) ---
        db.ref('orders').on('value', (s) => {
            const list = document.getElementById('order-list');
            list.innerHTML = "";
            if(!s.exists()) { list.innerHTML = "<p class='text-slate-500 italic'>Ch∆∞a c√≥ ƒë∆°n mua n√†o...</p>"; return; }

            s.forEach((item) => {
                const d = item.val();
                if(d.status === "ƒêang ch·ªù") {
                    list.innerHTML += `
                    <div class="flex justify-between items-center bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
                        <div>
                            <p class="text-[10px] text-slate-500 font-mono">ID: #${item.key.substring(1,7).toUpperCase()}</p>
                            <p class="font-black text-white text-lg">${d.product}</p>
                            <p class="text-blue-400 font-bold italic">T√†i kho·∫£n: ${d.acc}</p>
                            <p class="text-[10px] text-slate-400">Kh√°ch: ${d.customer}</p>
                        </div>
                        <button onclick="doneOrder('${item.key}')" class="btn-action bg-blue-600 px-6 py-3 rounded-xl shadow-lg shadow-blue-900/20">Giao Xong</button>
                    </div>`;
                }
            });
        });

        async function doneOrder(key) {
            if(confirm("X√°c nh·∫≠n ƒë√£ g·ª≠i qu√†/c√†y xong cho ƒë∆°n n√†y?")) {
                await db.ref('orders/' + key).update({ status: "Ho√†n th√†nh" });
                alert("ƒê√£ chuy·ªÉn tr·∫°ng th√°i sang Ho√†n th√†nh!");
            }
        }
    </script>
</body>
</html>
