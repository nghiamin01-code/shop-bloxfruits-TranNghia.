<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªÜ TH·ªêNG QU·∫¢N TR·ªä - SHOP B·∫ÆP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- S·ª≠ d·ª•ng b·∫£n m·ªõi nh·∫•t c·ªßa Firebase ƒë·ªÉ ƒë·∫£m b·∫£o ·ªïn ƒë·ªãnh -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f8fafc; }
        .glass-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; }
        .tab-active { background: #3b82f6; color: white; box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .btn-approve { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .btn-complete { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .status-badge { padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        .loader { border: 3px solid #1e293b; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-10">
        <!-- Dashboard Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
            <div class="flex items-center gap-5">
                <div class="w-16 h-16 bg-gradient-to-tr from-yellow-400 to-orange-500 rounded-2xl flex items-center justify-center text-slate-900 shadow-2xl">
                    <i class="fas fa-shield-halved text-3xl"></i>
                </div>
                <div>
                    <h1 class="text-4xl font-black tracking-tight">ADMIN <span class="text-yellow-400">PANEL</span></h1>
                    <p class="text-slate-500 text-xs font-bold uppercase tracking-widest mt-1">C·∫•u h√¨nh: ƒê·ªìng b·ªô Discord & Realtime</p>
                </div>
            </div>

            <nav class="flex bg-slate-900/50 p-1.5 rounded-2xl border border-slate-800">
                <button onclick="switchView('bank')" id="tab-bank" class="tab-active px-8 py-3 rounded-xl text-sm font-black transition-all duration-300">
                    <i class="fas fa-university mr-2"></i>Duy·ªát Bank
                </button>
                <button onclick="switchView('orders')" id="tab-orders" class="px-8 py-3 rounded-xl text-sm font-black text-slate-400 transition-all duration-300">
                    <i class="fas fa-shopping-bag mr-2"></i>ƒê∆°n D·ªãch V·ª•
                </button>
            </nav>
        </header>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
            <div class="glass-card p-5 border-l-4 border-yellow-500">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">N·∫°p Ch·ªù Duy·ªát</p>
                <h3 id="stat-bank" class="text-3xl font-black">0</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-blue-500">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">ƒê∆°n Ch·ªù X·ª≠ L√Ω</p>
                <h3 id="stat-orders" class="text-3xl font-black text-blue-400">0</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-emerald-500">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">K·∫øt n·ªëi DB</p>
                <h3 id="db-status" class="text-sm font-black text-amber-500 uppercase flex items-center gap-2 mt-2 italic">
                    <span class="w-2 h-2 bg-amber-500 rounded-full"></span> ƒêang k·∫øt n·ªëi...
                </h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-slate-700">
                <p class="text-[10px] font-extrabold text-slate-500 uppercase tracking-wider mb-1">Discord</p>
                <h3 id="discord-status" class="text-[10px] font-black text-slate-500 uppercase mt-2">Ch∆∞a c·∫•u h√¨nh Webhook</h3>
            </div>
        </div>

        <!-- Main Workspace -->
        <main>
            <!-- Bank Section -->
            <div id="view-bank" class="space-y-6">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-black flex items-center gap-3 italic"><i class="fas fa-money-bill-transfer text-emerald-400"></i> DUY·ªÜT N·∫†P TI·ªÄN BANK</h2>
                    <button onclick="testDiscord('bank')" class="text-[9px] font-bold bg-slate-800 px-3 py-1 rounded-lg hover:bg-slate-700">Test Discord Webhook</button>
                </div>
                <div id="list-bank" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                    <div class="col-span-full flex justify-center py-12"><div class="loader"></div></div>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="view-orders" class="space-y-6 hidden">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-black flex items-center gap-3 italic"><i class="fas fa-boxes-packing text-blue-400"></i> ƒê∆†N H√ÄNG D·ªäCH V·ª§</h2>
                </div>
                <div id="list-orders" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                    <div class="col-span-full flex justify-center py-12"><div class="loader"></div></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification system -->
    <div id="notify" class="fixed bottom-10 right-10 translate-y-32 opacity-0 transition-all duration-500 z-50">
        <div class="bg-white text-slate-900 px-8 py-4 rounded-2xl shadow-2xl font-black flex items-center gap-4 border-b-4 border-blue-500">
            <i class="fas fa-bell text-blue-500"></i>
            <span id="notify-msg">Th√†nh c√¥ng!</span>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH QUAN TR·ªåNG ---
        const firebaseConfig = { databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com/" };
        
        // D√°n URL Webhook Discord c·ªßa b·∫°n v√†o ƒë√¢y
        const DISCORD_WEBHOOK_URL = "D√ÅN_WEBHOOK_DISCORD_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY";

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ki·ªÉm tra k·∫øt n·ªëi DB
        db.ref('.info/connected').on('value', snap => {
            const status = document.getElementById('db-status');
            if (snap.val() === true) {
                status.innerHTML = '<span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span> ƒê√£ k·∫øt n·ªëi DB';
                status.className = "text-sm font-black text-emerald-500 uppercase flex items-center gap-2 mt-2 italic";
            } else {
                status.innerHTML = '<span class="w-2 h-2 bg-red-500 rounded-full"></span> M·∫•t k·∫øt n·ªëi';
                status.className = "text-sm font-black text-red-500 uppercase flex items-center gap-2 mt-2 italic";
            }
        });

        if(DISCORD_WEBHOOK_URL !== "D√ÅN_WEBHOOK_DISCORD_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY") {
            document.getElementById('discord-status').innerText = "ƒê√£ b·∫≠t Webhook";
            document.getElementById('discord-status').classList.replace('text-slate-500', 'text-emerald-400');
        }

        // --- G·ª≠i th√¥ng b√°o t·ªõi Discord ---
        async function sendDiscord(type, data) {
            if(!DISCORD_WEBHOOK_URL || DISCORD_WEBHOOK_URL.includes("D√ÅN_WEBHOOK")) return;

            let embed = {
                title: type === 'bank' ? "üí∞ TH√îNG B√ÅO N·∫†P TI·ªÄN" : "üì¶ C√ì ƒê∆†N H√ÄNG M·ªöI",
                color: type === 'bank' ? 3066993 : 3447003,
                timestamp: new Date().toISOString(),
                fields: []
            };

            if(type === 'bank') {
                embed.fields = [
                    { name: "Ng∆∞·ªùi n·∫°p", value: `@${data.user}`, inline: true },
                    { name: "S·ªë ti·ªÅn", value: `${data.amount.toLocaleString()}ƒë`, inline: true },
                    { name: "N·ªôi dung", value: data.memo || "Kh√¥ng c√≥" }
                ];
            } else {
                embed.fields = [
                    { name: "Kh√°ch h√†ng", value: `@${data.user}`, inline: true },
                    { name: "S·∫£n ph·∫©m", value: data.item, inline: true },
                    { name: "Th√¥ng tin ACC", value: `\`\`\`${data.info}\`\`\`` }
                ];
            }

            try {
                await fetch(DISCORD_WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ embeds: [embed] })
                });
            } catch (e) { console.error("Discord Error", e); }
        }

        // --- Duy·ªát Bank ---
        // S·ª¨A ƒê·ªîI: L·∫Øng nghe ch√≠nh x√°c ƒë∆∞·ªùng d·∫´n 'requests' ho·∫∑c 'naptien' t√πy code web c·ªßa b·∫°n
        db.ref('requests').on('value', snapshot => {
            const container = document.getElementById('list-bank');
            const data = snapshot.val();
            let count = 0;
            container.innerHTML = "";

            if(!data) {
                container.innerHTML = `<div class="col-span-full glass-card p-12 text-center text-slate-600 font-bold uppercase tracking-widest border-2 border-dashed border-slate-800">Kh√¥ng c√≥ y√™u c·∫ßu n·∫°p ti·ªÅn n√†o</div>`;
                document.getElementById('stat-bank').innerText = 0;
                return;
            }

            Object.keys(data).forEach(key => {
                count++;
                const item = data[key];
                container.innerHTML += `
                    <div class="glass-card p-6 border-t-2 border-emerald-500 shadow-xl hover:scale-[1.02] transition-transform">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h4 class="text-white font-black text-lg">@${item.user || '·∫®n danh'}</h4>
                                <p class="text-[10px] text-slate-500 font-bold">${item.time || 'V·ª´a xong'}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-emerald-400 font-black text-xl">+${(item.amount || 0).toLocaleString()}ƒë</p>
                            </div>
                        </div>
                        <div class="bg-black/20 p-3 rounded-lg mb-4 border border-slate-800/50">
                             <p class="text-[9px] text-slate-500 font-bold uppercase mb-1">N·ªôi dung chuy·ªÉn kho·∫£n:</p>
                             <p class="text-xs font-bold text-slate-300">${item.memo || 'Kh√¥ng c√≥'}</p>
                        </div>
                        <div class="space-y-2">
                            <button onclick="approveBank('${item.user}', ${item.amount}, '${key}')" class="w-full btn-approve text-white font-black py-3 rounded-xl shadow-lg active:scale-95 transition-all">DUY·ªÜT TI·ªÄN</button>
                            <button onclick="rejectReq('${key}')" class="w-full text-[10px] font-bold text-slate-600 hover:text-red-400 py-2 transition-colors uppercase">H·ªßy b·ªè</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('stat-bank').innerText = count;
        });

        // --- ƒê∆°n H√†ng ---
        db.ref('orders').on('value', snapshot => {
            const container = document.getElementById('list-orders');
            const data = snapshot.val();
            let pending = 0;
            container.innerHTML = "";

            if(!data) {
                container.innerHTML = `<div class="col-span-full glass-card p-12 text-center text-slate-600 font-bold uppercase tracking-widest border-2 border-dashed border-slate-800">Kh√¥ng c√≥ ƒë∆°n h√†ng m·ªõi</div>`;
                document.getElementById('stat-orders').innerText = 0;
                return;
            }

            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                if(item.status === 'ƒêang x·ª≠ l√Ω') {
                    pending++;
                    container.innerHTML += `
                        <div class="glass-card p-6 border-t-2 border-blue-500 shadow-xl">
                            <div class="flex justify-between mb-4">
                                <span class="bg-blue-500/10 text-blue-400 px-2 py-1 rounded-md text-[10px] font-black uppercase">${item.item}</span>
                                <span class="text-[10px] text-slate-600 font-bold">${item.time}</span>
                            </div>
                            <p class="text-sm font-bold text-slate-400 mb-4">Kh√°ch: <span class="text-white">@${item.user}</span></p>
                            
                            <div class="bg-black/40 p-4 rounded-xl border border-slate-800 mb-6 group relative">
                                <p class="text-[9px] text-slate-600 font-bold uppercase mb-2">Th√¥ng tin t√†i kho·∫£n:</p>
                                <p id="txt-${key}" class="text-xs font-mono text-blue-300 break-all">${item.info}</p>
                                <button onclick="copyTxt('${key}')" class="absolute top-3 right-3 text-slate-700 hover:text-white transition-colors">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>

                            <div class="grid grid-cols-4 gap-2">
                                <button onclick="doneOrder('${key}')" class="col-span-3 btn-complete text-white font-black py-3 rounded-xl shadow-lg active:scale-95 transition-all">HO√ÄN T·∫§T</button>
                                <button onclick="delOrder('${key}')" class="bg-slate-800 hover:bg-red-900/40 text-slate-500 rounded-xl transition-all"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `;
                }
            });
            document.getElementById('stat-orders').innerText = pending;
        });

        // --- Logic X·ª≠ l√Ω ---
        async function approveBank(user, amount, key) {
            if(!confirm(`X√°c nh·∫≠n c·ªông ${amount.toLocaleString()}ƒë cho ${user}?`)) return;
            try {
                const userRef = db.ref('users/' + user);
                const snap = await userRef.once('value');
                const curBalance = (snap.val()?.balance) || 0;
                
                await userRef.update({ balance: curBalance + amount });
                const reqData = (await db.ref('requests/' + key).get()).val();
                await db.ref('requests/' + key).remove();
                
                showNotify(`ƒê√£ n·∫°p th√†nh c√¥ng cho @${user}`);
                sendDiscord('bank', reqData);
            } catch(e) { showNotify("L·ªói: " + e.message); }
        }

        async function doneOrder(key) {
            await db.ref('orders/' + key).update({ status: 'Ho√†n th√†nh' });
            showNotify("ƒê√£ ho√†n t·∫•t ƒë∆°n h√†ng!");
        }

        function rejectReq(key) { if(confirm("H·ªßy y√™u c·∫ßu n√†y?")) db.ref('requests/' + key).remove(); }
        function delOrder(key) { if(confirm("X√≥a ƒë∆°n n√†y?")) db.ref('orders/' + key).remove(); }

        function switchView(view) {
            document.getElementById('view-bank').classList.toggle('hidden', view !== 'bank');
            document.getElementById('view-orders').classList.toggle('hidden', view !== 'orders');
            document.getElementById('tab-bank').className = (view === 'bank' ? 'tab-active' : '') + ' px-8 py-3 rounded-xl text-sm font-black transition-all';
            document.getElementById('tab-orders').className = (view === 'orders' ? 'tab-active' : '') + ' px-8 py-3 rounded-xl text-sm font-black transition-all';
        }

        function showNotify(msg) {
            const toast = document.getElementById('notify');
            document.getElementById('notify-msg').innerText = msg;
            toast.classList.remove('translate-y-32', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-32', 'opacity-0'), 3000);
        }

        function copyTxt(key) {
            const text = document.getElementById('txt-' + key).innerText;
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showNotify("ƒê√£ sao ch√©p!");
        }

        async function testDiscord(type) {
            showNotify("ƒêang g·ª≠i th·ª≠ Discord...");
            await sendDiscord(type, { user: "Admin_Test", amount: 100000, memo: "N·∫°p th·ª≠ nghi·ªám", item: "S·∫£n ph·∫©m Test", info: "T√†i kho·∫£n: admin | Pass: 123" });
        }
    </script>
</body>
</html>
