<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIREBASE EXPLORER - CẤU CỨU DỮ LIỆU</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .code-font { font-family: 'Fira Code', monospace; }
        .json-key { color: #f472b6; }
        .json-value { color: #34d399; }
        .json-string { color: #fbbf24; }
        .path-tag { background: #1e293b; border: 1px solid #334155; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <header class="mb-10 text-center">
            <h1 class="text-3xl font-black text-white mb-2 uppercase tracking-tighter">Công Cụ Truy Tìm Đơn Hàng</h1>
            <p class="text-slate-400 italic">Quét toàn bộ Database để tìm dữ liệu bị ẩn hoặc sai đường dẫn</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-4">
                <div class="bg-slate-800/50 p-6 rounded-3xl border border-white/5">
                    <h2 class="text-xs font-bold text-slate-500 uppercase mb-4">Trạng thái kết nối</h2>
                    <div id="status" class="flex items-center gap-2 text-red-500 font-bold uppercase text-[10px]">
                        <span class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></span>
                        Đang kiểm tra...
                    </div>
                    <div class="mt-6">
                        <p class="text-[10px] text-slate-500 mb-1 uppercase">Database URL:</p>
                        <p id="db-url-display" class="text-[9px] break-all opacity-50 italic"></p>
                    </div>
                </div>

                <div class="bg-blue-600/10 p-6 rounded-3xl border border-blue-500/20">
                    <p class="text-xs text-blue-400 leading-relaxed font-medium">
                        <i class="fas fa-info-circle mr-1"></i>
                        Công cụ này sẽ đọc <b>gốc (root)</b> của Database. Nếu có bất kỳ đơn hàng nào, nó sẽ hiện ra ở cột bên phải.
                    </p>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-3">
                <div class="bg-slate-900 border border-white/10 rounded-3xl overflow-hidden shadow-2xl">
                    <div class="bg-white/5 p-4 flex justify-between items-center border-b border-white/10">
                        <span class="text-xs font-bold uppercase tracking-widest text-slate-400">Dữ liệu thô tìm thấy</span>
                        <button onclick="location.reload()" class="text-[10px] bg-white/10 px-3 py-1 rounded-full hover:bg-white/20 transition-all">LÀM MỚI</button>
                    </div>
                    <div id="explorer-content" class="p-6 overflow-auto max-h-[70vh] code-font text-sm leading-relaxed">
                        <p class="animate-pulse text-slate-500 italic">Đang tải dữ liệu từ gốc...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cấu hình Database của bạn
        const firebaseConfig = {
            databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com/"
        };
        
        document.getElementById('db-url-display').innerText = firebaseConfig.databaseURL;
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Kiểm tra kết nối
        db.ref('.info/connected').on('value', (snap) => {
            const statusDiv = document.getElementById('status');
            if (snap.val() === true) {
                statusDiv.innerHTML = `<span class="w-3 h-3 rounded-full bg-green-500 shadow-[0_0_8px_green]"></span> KẾT NỐI THÀNH CÔNG`;
                statusDiv.classList.replace('text-red-500', 'text-green-500');
            } else {
                statusDiv.innerHTML = `<span class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></span> KHÔNG THỂ KẾT NỐI`;
                statusDiv.classList.replace('text-green-500', 'text-red-500');
            }
        });

        // Quét toàn bộ Root
        db.ref('/').on('value', (snapshot) => {
            const content = document.getElementById('explorer-content');
            const data = snapshot.val();

            if (!data) {
                content.innerHTML = `
                    <div class="text-center py-20">
                        <p class="text-orange-400 font-bold mb-2 uppercase italic text-lg">Database Trống Rỗng!</p>
                        <p class="text-slate-500 text-sm">Kết nối thành công nhưng không tìm thấy bảng nào.</p>
                        <p class="text-slate-500 text-xs mt-4 italic">Gợi ý: Hãy thử đặt 1 đơn hàng trên trang chủ rồi quay lại đây.</p>
                    </div>
                `;
                return;
            }

            // Hiển thị dữ liệu dưới dạng cây thư mục đẹp mắt
            content.innerHTML = renderObject(data);
        });

        function renderObject(obj, indent = 0) {
            let html = "";
            const keys = Object.keys(obj);
            
            keys.forEach((key, index) => {
                const value = obj[key];
                const isObject = typeof value === 'object' && value !== null;
                const padding = " ".repeat(indent * 4);
                
                if (isObject) {
                    html += `<div>${padding}<span class="json-key font-bold">"${key}"</span>: {</div>`;
                    html += renderObject(value, indent + 1);
                    html += `<div>${padding}}</div>`;
                } else {
                    let valueClass = typeof value === 'string' ? 'json-string' : 'json-value';
                    let displayValue = typeof value === 'string' ? `"${value}"` : value;
                    html += `<div>${padding}<span class="json-key">"${key}"</span>: <span class="${valueClass}">${displayValue}</span>${index < keys.length - 1 ? ',' : ''}</div>`;
                }
            });
            return html;
        }
    </script>
</body>
</html>
