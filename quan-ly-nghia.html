<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Nghĩa Elemental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background: #020617; font-family: 'Orbitron', sans-serif; color: white; }
        .card { background: rgba(30, 41, 59, 0.8); border: 1px solid #334155; border-radius: 12px; }
        .btn-approve { background: #16a34a; transition: 0.3s; }
        .btn-approve:hover { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        th { text-transform: uppercase; font-size: 11px; color: #94a3b8; border-bottom: 2px solid #334155; padding: 12px; }
        td { padding: 12px; border-bottom: 1px solid #1e293b; font-size: 13px; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-black text-red-500 mb-8 uppercase italic">Quản Lý Đơn Hàng</h1>

        <div class="grid grid-cols-1 gap-8">
            <div class="card p-6">
                <h2 class="text-xl font-bold text-blue-400 mb-4">DUYỆT NẠP BANK (CỘNG TIỀN VÍ)</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr>
                                <th>Khách Hàng</th>
                                <th>Số Tiền</th>
                                <th>Nội Dung Chuyển</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody id="bank-list">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="card p-6">
                <h2 class="text-xl font-bold text-yellow-500 mb-4">DANH SÁCH CÀY THUÊ</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr>
                                <th>Dịch Vụ</th>
                                <th>Tài Khoản / Mật Khẩu</th>
                                <th>Giá</th>
                                <th>Thao Tác</th>
                            </tr>
                        </thead>
                        <tbody id="cay-list">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Hàm load dữ liệu từ hệ thống
        function loadOrders() {
            // Lấy dữ liệu từ localStorage (hoặc fetch từ database nếu bạn đã setup SQL)
            const bankOrders = JSON.parse(localStorage.getItem('nghia_bank')) || [];
            const cayOrders = JSON.parse(localStorage.getItem('nghia_cay')) || [];

            // Render Bank
            document.getElementById('bank-list').innerHTML = bankOrders.map((o, i) => `
                <tr>
                    <td>${o.user}</td>
                    <td class="text-green-400 font-bold">+${o.amount.toLocaleString()}đ</td>
                    <td class="text-gray-400 italic">${o.content}</td>
                    <td>
                        <button onclick="approveBank(${i})" class="btn-approve px-4 py-1 rounded text-white font-bold text-[10px]">DUYỆT & CỘNG TIỀN</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="4" class="text-center text-gray-500 py-4">Chưa có đơn bank...</td></tr>';

            // Render Cày Thuê
            document.getElementById('cay-list').innerHTML = cayOrders.map((o, i) => `
                <tr>
                    <td class="text-yellow-400 font-bold">${o.service}</td>
                    <td>TK: ${o.acc} <br> MK: ${o.pass}</td>
                    <td>${o.price.toLocaleString()}đ</td>
                    <td>
                        <button onclick="doneCay(${i})" class="bg-blue-600 px-4 py-1 rounded text-white font-bold text-[10px]">HOÀN THÀNH</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="4" class="text-center text-gray-500 py-4">Chưa có đơn cày thuê...</td></tr>';
        }

        // HÀM DUYỆT VÀ TỰ ĐỘNG CỘNG TIỀN
        function approveBank(index) {
            let bankOrders = JSON.parse(localStorage.getItem('nghia_bank')) || [];
            let currentBalance = parseInt(localStorage.getItem('nghia_balance')) || 0;

            // 1. Cộng tiền vào tài khoản
            const addedAmount = bankOrders[index].amount;
            currentBalance += addedAmount;
            localStorage.setItem('nghia_balance', currentBalance);

            // 2. Xóa đơn đã duyệt khỏi danh sách chờ
            bankOrders.splice(index, 1);
            localStorage.setItem('nghia_bank', JSON.stringify(bankOrders));

            alert(`Duyệt thành công! Đã cộng ${addedAmount.toLocaleString()}đ vào ví của khách.`);
            loadOrders();
        }

        function doneCay(index) {
            let cayOrders = JSON.parse(localStorage.getItem('nghia_cay')) || [];
            cayOrders.splice(index, 1);
            localStorage.setItem('nghia_cay', JSON.stringify(cayOrders));
            alert("Đã xác nhận hoàn thành đơn cày thuê!");
            loadOrders();
        }

        // Khởi chạy
        loadOrders();
        // Cập nhật sau mỗi 3 giây để nhận đơn mới từ khách
        setInterval(loadOrders, 3000);
    </script>
</body>
</html>
