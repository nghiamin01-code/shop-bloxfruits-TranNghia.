<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ADMIN - BAP SHOP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body class="bg-slate-900 text-white p-10">
    <h1 class="text-3xl font-black mb-10 text-center uppercase">Hệ Thống Quản Trị BAP SHOP</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700">
            <h2 class="text-xl font-bold mb-4 text-green-400">Duyệt Bank/QR</h2>
            <div id="danh-sách-ngân-hàng" class="space-y-4"></div>
        </div>

        <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700">
            <h2 class="text-xl font-bold mb-4 text-blue-400">Đơn Hàng Mới (Cày Thuê/Trái)</h2>
            <div id="danh-sách-đơn-hàng" class="space-y-4"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Hàm Duyệt Bank & Cộng Tiền
        async function duyệtNạp(uid, mãĐơn, sốTiền) {
            if(confirm("Xác nhận cộng " + sốTiền + "đ cho khách?")) {
                const refKhách = db.ref('người dùng/' + uid);
                const snap = await refKhách.get();
                const tiềnHiệnTại = snap.val()['THĂNG BẰNG'] || 0;

                await refKhách.update({ "THĂNG BẰNG": tiềnHiệnTại + parseInt(sốTiền) });
                await db.ref('lịch sử/' + uid + '/' + mãĐơn).update({ "trạng thái": "Thành công" });
                
                alert("Đã cộng tiền!");
                location.reload();
            }
        }

        // Tải đơn hàng từ Firebase
        db.ref('lịch sử').on('value', snap => {
            const bankDiv = document.getElementById('danh-sách-ngân-hàng');
            const orderDiv = document.getElementById('danh-sách-đơn-hàng');
            bankDiv.innerHTML = ""; orderDiv.innerHTML = "";

            snap.forEach(userSnap => {
                const uid = userSnap.key;
                userSnap.forEach(orderSnap => {
                    const đơn = orderSnap.val();
                    const html = `
                        <div class="p-4 bg-slate-700 rounded-xl flex justify-between items-center">
                            <div>
                                <p class="font-bold">${đơn['nội dung']}</p>
                                <p class="text-xs text-slate-400">Tiền: ${đơn['số tiền']}đ</p>
                            </div>
                            <button onclick="duyệtNạp('${uid}', '${orderSnap.key}', ${đơn['số tiền']})" class="bg-green-500 px-4 py-2 rounded-lg font-bold text-xs">Duyệt</button>
                        </div>`;
                    
                    if(đơn['loại'] === 'bank') bankDiv.innerHTML += html;
                    else orderDiv.innerHTML += html;
                });
            });
        });
    </script>
</body>
</html>
