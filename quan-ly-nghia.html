<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>QUẢN TRỊ SHOP BẮP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-900 text-white p-6 font-sans">
    <h1 class="text-2xl font-bold text-yellow-500 mb-6">QUẢN LÝ SHOP BẮP</h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-gray-800 p-4 rounded-xl">
            <h2 class="text-xl mb-4 font-bold text-green-400 border-b border-gray-700 pb-2">THẺ CHỜ DUYỆT</h2>
            <div id="list-card" class="space-y-3"></div>
        </div>

        <div class="bg-gray-800 p-4 rounded-xl">
            <h2 class="text-xl mb-4 font-bold text-blue-400 border-b border-gray-700 pb-2">ĐƠN HÀNG MỚI</h2>
            <div id="list-order" class="space-y-3"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://shop-bloxfruit-trannghia-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Tự động load thẻ nạp
        db.ref('napthe').on('value', s => {
            let h = "";
            s.forEach(c => {
                let d = c.val();
                if(d.status === "Chờ duyệt") {
                    h += `<div class="bg-gray-700 p-3 rounded-lg border-l-4 border-yellow-500">
                        <p><b>User:</b> ${d.user} | <b>Mệnh giá:</b> ${d.real}đ</p>
                        <p class="text-xs text-gray-400">PIN: ${d.pin} | Seri: ${d.seri} | Loại: ${d.telco}</p>
                        <button onclick="duyet('${c.key}', '${d.userKey}', ${d.real})" class="mt-2 bg-green-600 px-4 py-1 rounded text-xs font-bold">CỘNG TIỀN ✅</button>
                    </div>`;
                }
            });
            document.getElementById('list-card').innerHTML = h || "Không có thẻ nào.";
        });

        // Load đơn hàng
        db.ref('orders').on('value', s => {
            let h = "";
            s.forEach(o => {
                let d = o.val();
                h += `<div class="bg-gray-700 p-3 rounded-lg border-l-4 border-blue-500 text-xs">
                    <p><b>Khách:</b> ${d.user} | <b>Mua:</b> ${d.item}</p>
                    <p class="text-yellow-400"><b>Thông tin:</b> ${d.info}</p>
                    <p class="text-gray-500">${d.time}</p>
                </div>`;
            });
            document.getElementById('list-order').innerHTML = h || "Chưa có đơn hàng.";
        });

        function duyet(key, userK, money) {
            db.ref('users/' + userK).once('value', s => {
                let current = s.val().balance || 0;
                db.ref('users/' + userK).update({ balance: current + Number(money) });
                db.ref('napthe/' + key).update({ status: "Xong" });
                alert("Đã cộng tiền!");
            });
        }
    </script>
</body>
</html>
