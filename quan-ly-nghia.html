<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QU·∫¢N TR·ªä VI√äN - SHOP B·∫ÆP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; }
        .status-pill { padding: 4px 12px; border-radius: 9999px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .tab-btn.active { background: #3b82f6; color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-yellow-400 rounded-2xl flex items-center justify-center text-slate-900 shadow-[0_0_20px_rgba(250,204,21,0.3)]">
                    <i class="fas fa-crown text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-black tracking-tighter text-white">SHOP B·∫ÆP <span class="text-yellow-400">ADMIN</span></h1>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">H·ªá th·ªëng qu·∫£n l√Ω th·ªùi gian th·ª±c</p>
                </div>
            </div>

            <div class="flex bg-slate-800/50 p-1.5 rounded-2xl border border-slate-700">
                <button onclick="switchTab('bank')" id="btn-bank" class="tab-btn active px-6 py-2.5 rounded-xl text-sm font-bold transition-all">
                    <i class="fas fa-university mr-2"></i>Duy·ªát Bank
                </button>
                <button onclick="switchTab('orders')" id="btn-orders" class="tab-btn px-6 py-2.5 rounded-xl text-sm font-bold transition-all">
                    <i class="fas fa-shopping-cart mr-2"></i>ƒê∆°n H√†ng
                </button>
            </div>
        </header>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="glass-card p-5 border-l-4 border-yellow-400">
                <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Y√™u c·∫ßu n·∫°p</p>
                <p id="count-bank" class="text-2xl font-black text-white">0</p>
            </div>
            <div class="glass-card p-5 border-l-4 border-blue-400">
                <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">ƒê∆°n ch·ªù duy·ªát</p>
                <p id="count-orders" class="text-2xl font-black text-white">0</p>
            </div>
            <div class="glass-card p-5 border-l-4 border-green-400">
                <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">ƒê√£ ho√†n t·∫•t</p>
                <p id="count-done" class="text-2xl font-black text-white">0</p>
            </div>
            <div class="glass-card p-5 border-l-4 border-indigo-400">
                <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Tr·∫°ng th√°i DB</p>
                <p class="text-sm font-black text-green-400 uppercase">Online</p>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="grid grid-cols-1 gap-8">
            <!-- Bank List Section -->
            <section id="section-bank" class="space-y-4">
                <div class="flex items-center justify-between px-2">
                    <h2 class="font-black text-xl flex items-center gap-2"><i class="fas fa-money-check-alt text-green-400"></i> DUY·ªÜT N·∫†P TI·ªÄN</h2>
                    <span class="text-xs text-slate-500 font-bold uppercase tracking-tighter">T·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 1s</span>
                </div>
                <div id="bank-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-slate-300 italic">
                    ƒêang k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu...
                </div>
            </section>

            <!-- Order List Section -->
            <section id="section-orders" class="space-y-4 hidden">
                <div class="flex items-center justify-between px-2">
                    <h2 class="font-black text-xl flex items-center gap-2"><i class="fas fa-box-open text-blue-400"></i> ƒê∆†N H√ÄNG D·ªäCH V·ª§</h2>
                    <span class="text-xs text-slate-500 font-bold uppercase tracking-tighter">X·ª≠ l√Ω ngay k·∫ªo kh√°ch ƒë·ª£i</span>
                </div>
                <div id="order-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-slate-300 italic">
                    ƒêang t·∫£i danh s√°ch ƒë∆°n h√†ng...
                </div>
            </section>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-10 right-10 translate-y-20 opacity-0 transition-all duration-500 z-50">
        <div class="bg-blue-600 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 border border-blue-400">
            <i class="fas fa-bell animate-bounce"></i>
            <span id="toast-msg" class="font-bold text-sm">Th√¥ng b√°o h·ªá th·ªëng</span>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH FIREBASE ---
        const firebaseConfig = { databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentTab = 'bank';

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('section-bank').classList.toggle('hidden', tab !== 'bank');
            document.getElementById('section-orders').classList.toggle('hidden', tab !== 'orders');
            document.getElementById('btn-bank').classList.toggle('active', tab === 'bank');
            document.getElementById('btn-orders').classList.toggle('active', tab === 'orders');
        }

        // --- 1. THEO D√ïI N·∫†P BANK ---
        db.ref('requests').on('value', s => {
            const list = document.getElementById('bank-list');
            const data = s.val();
            let count = 0;
            list.innerHTML = "";

            if(!data) {
                list.innerHTML = `<div class="col-span-full glass-card p-10 text-center text-slate-500 font-bold">‚úÖ Hi·ªán t·∫°i kh√¥ng c√≥ y√™u c·∫ßu n·∫°p ti·ªÅn n√†o.</div>`;
                document.getElementById('count-bank').innerText = 0;
                return;
            }

            Object.keys(data).forEach(key => {
                count++;
                const item = data[key];
                list.innerHTML += `
                    <div class="glass-card p-6 border-t-4 border-green-500 hover:scale-[1.02] transition-transform">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-yellow-400 font-black text-lg">@${item.user}</p>
                                <p class="text-[10px] text-slate-500 font-bold uppercase">${item.time}</p>
                            </div>
                            <span class="bg-green-500/10 text-green-400 px-3 py-1 rounded-lg font-black text-sm">+${item.amount.toLocaleString()}ƒë</span>
                        </div>
                        <div class="flex flex-col gap-2 mt-6">
                            <button onclick="approveBank('${item.user}', ${item.amount}, '${key}')" class="w-full bg-green-600 hover:bg-green-500 text-white font-black py-3 rounded-xl shadow-lg shadow-green-900/20 transition-all active:scale-95">DUY·ªÜT NGAY</button>
                            <button onclick="deleteReq('${key}')" class="text-xs text-slate-500 font-bold hover:text-red-400 transition-colors uppercase tracking-widest mt-2">T·ª´ ch·ªëi & X√≥a</button>
                        </div>
                    </div>`;
            });
            document.getElementById('count-bank').innerText = count;
        });

        async function approveBank(user, amount, key) {
            if(confirm(`X√°c nh·∫≠n c·ªông ${amount.toLocaleString()}ƒë cho t√†i kho·∫£n ${user}?`)) {
                try {
                    const userRef = db.ref('users/' + user);
                    const snapshot = await userRef.get();
                    const userData = snapshot.val() || { balance: 0 };
                    const currentBalance = userData.balance || 0;
                    
                    await userRef.update({ balance: currentBalance + amount });
                    await db.ref('requests/' + key).remove();
                    showToast(`ƒê√£ c·ªông ${amount.toLocaleString()}ƒë cho ${user}!`);
                } catch (e) {
                    alert("L·ªói khi c·ªông ti·ªÅn: " + e.message);
                }
            }
        }

        function deleteReq(key) { if(confirm("X√≥a y√™u c·∫ßu n√†y?")) db.ref('requests/' + key).remove(); }

        // --- 2. THEO D√ïI ƒê∆†N H√ÄNG ---
        db.ref('orders').on('value', s => {
            const list = document.getElementById('order-list');
            const data = s.val();
            let countPending = 0;
            let countDone = 0;
            list.innerHTML = "";

            if(!data) {
                list.innerHTML = `<div class="col-span-full glass-card p-10 text-center text-slate-500 font-bold">‚òï Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o trong h·ªá th·ªëng.</div>`;
                document.getElementById('count-orders').innerText = 0;
                return;
            }

            Object.keys(data).reverse().forEach(key => {
                const item = data[key];
                if(item.status === 'ƒêang x·ª≠ l√Ω') {
                    countPending++;
                    list.innerHTML += `
                        <div class="glass-card p-6 border-t-4 border-blue-500">
                            <div class="flex justify-between items-center mb-4">
                                <span class="bg-blue-500 text-white text-[10px] font-black px-2 py-1 rounded uppercase">${item.item}</span>
                                <span class="text-[10px] text-slate-500 font-bold">${item.time}</span>
                            </div>
                            <p class="text-sm mb-4">üë§ Kh√°ch: <b class="text-yellow-400 font-black">${item.user}</b></p>
                            
                            <div class="bg-slate-900/80 p-4 rounded-xl border border-slate-700 mb-6 relative group">
                                <p class="text-[10px] text-slate-500 uppercase font-bold mb-1">Th√¥ng tin ƒëƒÉng nh·∫≠p:</p>
                                <p id="info-${key}" class="text-xs font-mono text-blue-300 break-all leading-relaxed">${item.info}</p>
                                <button onclick="copyInfo('${key}')" class="absolute top-2 right-2 text-slate-600 hover:text-white transition-colors">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>

                            <div class="flex gap-2">
                                <button onclick="completeOrder('${key}')" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-black py-3 rounded-xl transition-all shadow-lg shadow-blue-900/20 active:scale-95">XONG ‚úÖ</button>
                                <button onclick="deleteOrder('${key}')" class="bg-slate-800 hover:bg-red-900/50 text-slate-400 px-4 rounded-xl transition-colors border border-slate-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>`;
                } else {
                    countDone++;
                }
            });
            document.getElementById('count-orders').innerText = countPending;
            document.getElementById('count-done').innerText = countDone;
        });

        async function completeOrder(key) {
            if(confirm("ƒê√£ tr·∫£ xong ƒë∆°n n√†y cho kh√°ch?")) {
                await db.ref('orders/' + key).update({ status: 'Ho√†n th√†nh' });
                showToast("ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n th√†nh HO√ÄN TH√ÄNH!");
            }
        }

        function deleteOrder(key) { if(confirm("X√≥a b·ªè vƒ©nh vi·ªÖn ƒë∆°n h√†ng n√†y?")) db.ref('orders/' + key).remove(); }

        // --- UTILS ---
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        function copyInfo(key) {
            const text = document.getElementById('info-' + key).innerText;
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast("ƒê√£ copy th√¥ng tin t√†i kho·∫£n!");
        }
    </script>
</body>
</html>
