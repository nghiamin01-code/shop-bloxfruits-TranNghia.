<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGHIA SHOP - Blox Fruit Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap');
        body { background: #050810; color: white; font-family: 'Outfit', sans-serif; scroll-behavior: smooth; }
        .input-auth { background: #0f172a; border: 1px solid #1e293b; padding: 12px; border-radius: 12px; width: 100%; color: white; outline: none; transition: 0.3s; }
        .input-auth:focus { border-color: #3b82f6; }
        .card { background: #111827; border: 1px solid #1f2937; border-radius: 20px; padding: 10px; transition: 0.3s; text-align: center; overflow: hidden; }
        .card:hover { border-color: #3b82f6; transform: translateY(-5px); }
        .card img { width: 100%; border-radius: 15px; margin-bottom: 8px; transition: 0.3s; aspect-ratio: 1/1; object-fit: cover; }
        .card:hover img { transform: scale(1.05); }
        .tab-btn { padding: 12px; border-radius: 12px; font-weight: 800; font-size: 11px; text-transform: uppercase; flex: 1; text-align: center; cursor: pointer; }
        .active-tab { background: #2563eb; color: white; }
        .inactive-tab { background: #1e293b; color: #64748b; }
        .btn-buy { background: #2563eb; width: 100%; padding: 8px; border-radius: 10px; font-weight: 900; font-size: 10px; text-transform: uppercase; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; align-items: center; justify-content: center; padding: 1rem; }
    </style>
</head>
<body>
    <nav class="p-4 bg-[#0b0f1a] border-b border-white/5 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black italic text-blue-500 cursor-pointer" onclick="location.reload()">NGHIA SHOP</h1>
            <div id="auth-buttons"><button onclick="openAuth()" class="bg-blue-600 px-6 py-2 rounded-xl font-black text-xs uppercase">ÄÄƒng Nháº­p</button></div>
            <div id="user-info" class="hidden flex items-center gap-4">
                <div class="text-right"><p id="display-name" class="font-black text-blue-400 text-sm uppercase"></p><p class="text-yellow-400 font-bold text-xs italic">VÃ­: <span id="balance">0</span>Ä‘</p></div>
                <button onclick="auth.signOut().then(()=>location.reload())" class="bg-red-500/20 text-red-500 p-2 rounded-lg text-[10px] font-bold">THOÃT</button>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
            <div class="bg-blue-900/10 p-6 rounded-3xl border border-blue-500/20">
                <h2 class="font-black text-lg uppercase italic mb-6 text-blue-400">ğŸ’³ Náº¡p Tháº» CÃ o (CÃ³ Chiáº¿t Kháº¥u)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-3">
                        <select id="card-type" class="input-auth"><option value="VIETTEL">Viettel</option><option value="MOBIFONE">Mobifone</option><option value="VINAPHONE">Vinaphone</option></select>
                        <select id="card-amount" class="input-auth" onchange="updateRealAmount()">
                            <option value="10000">10,000Ä‘</option>
                            <option value="20000">20,000Ä‘</option>
                            <option value="30000">30,000Ä‘</option>
                            <option value="50000">50,000Ä‘</option>
                            <option value="100000">100,000Ä‘</option>
                            <option value="200000">200,000Ä‘</option>
                            <option value="500000">500,000Ä‘</option>
                            <option value="1000000">1,000,000Ä‘</option>
                        </select>
                    </div>
                    <div class="space-y-3">
                        <input id="card-seri" placeholder="Sá»‘ Seri..." class="input-auth">
                        <input id="card-pin" placeholder="MÃ£ tháº»..." class="input-auth">
                    </div>
                </div>
                <div class="mt-4 p-4 bg-black/40 rounded-xl border border-white/5">
                    <p class="text-xs text-slate-400 uppercase font-bold">Sá»‘ tiá»n báº¡n sáº½ nháº­n Ä‘Æ°á»£c:</p>
                    <p id="real-amount-text" class="text-xl font-black text-yellow-400">Thá»±c nháº­n: 9,210Ä‘</p>
                </div>
                <button onclick="guiThe()" class="w-full mt-4 bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black text-sm uppercase transition-all shadow-lg shadow-blue-500/20">Gá»­i Tháº» Chá» Duyá»‡t</button>
            </div>

            <div class="bg-green-900/10 p-6 rounded-3xl border border-green-500/20 text-center">
                <h2 class="font-black text-lg uppercase italic mb-4 text-green-400">ğŸ“² Náº¡p Tiá»n Qua QR (KhÃ´ng Chiáº¿t Kháº¥u)</h2>
                <div class="bg-white p-2 rounded-2xl inline-block mb-4 shadow-lg shadow-green-500/10">
                    <img src="https://i.postimg.cc/wjgX8bJ8/74b766b2-91f0-441c-95da-71b054c4a8c2.jpg" 
                         class="w-48 h-48 object-contain rounded-xl">
                </div>
                <div class="text-left space-y-2">
                    <div class="bg-black/40 p-3 rounded-xl border border-white/5">
                        <p class="text-[10px] text-slate-400 uppercase font-bold">Ná»™i dung chuyá»ƒn khoáº£n:</p>
                        <p id="qr-note-text" class="text-green-400 font-black text-sm italic">NAP [TÃªn tÃ i khoáº£n cá»§a báº¡n]</p>
                    </div>
                    <p class="text-[10px] text-slate-500 italic">* LÆ°u Ã½: Sau khi chuyá»ƒn khoáº£n, vui lÃ²ng chá» NghÄ©a kiá»ƒm tra vÃ  cá»™ng tiá»n vÃ o vÃ­ cho báº¡n nhÃ©!</p>
                    <button onclick="notifyQRTransfer()" class="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-black text-xs uppercase shadow-lg shadow-green-500/20">BÃ¡o ÄÃ£ Chuyá»ƒn Khoáº£n</button>
                </div>
            </div>
        </div>

        <div class="flex gap-2 mb-8 bg-[#0b0f1a] p-1.5 rounded-2xl border border-white/5">
            <div onclick="showTab('fruit')" id="btn-fruit" class="tab-btn active-tab">ğŸ TrÃ¡i VÄ©nh Viá»…n</div>
            <div onclick="showTab('gp')" id="btn-gp" class="tab-btn inactive-tab">ğŸ« Gamepass</div>
            <div onclick="showTab('ct')" id="btn-ct" class="tab-btn inactive-tab">âš”ï¸ CÃ y ThuÃª</div>
        </div>

        <div id="fruit-list" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        <div id="gp-list" class="hidden grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        <div id="ct-list" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <div id="auth-modal" class="modal">
        <div class="bg-[#111827] p-8 rounded-3xl w-full max-w-sm border border-white/5 text-center">
            <h2 id="m-title" class="text-2xl font-black text-blue-500 mb-6 uppercase">ÄÄ‚NG NHáº¬P</h2>
            <input id="u" placeholder="TÃªn tÃ i khoáº£n..." class="input-auth mb-3 w-full">
            <input id="p" type="password" placeholder="Máº­t kháº©u..." class="input-auth mb-4 w-full">
            <button onclick="handleAuth()" class="w-full bg-blue-600 py-4 rounded-xl font-black uppercase text-xs">XÃ¡c Nháº­n</button>
            <p onclick="isL=!isL; document.getElementById('m-title').innerText=isL?'ÄÄ‚NG NHáº¬P':'ÄÄ‚NG KÃ'" class="mt-6 text-[10px] text-slate-500 cursor-pointer font-bold uppercase">Äá»•i ÄÄƒng Nháº­p / ÄÄƒng KÃ½</p>
        </div>
    </div>

    <div id="order-modal" class="modal">
        <div class="bg-[#0f172a] p-8 rounded-[2.5rem] w-full max-w-md border border-white/5">
            <h2 class="text-xl font-black text-blue-500 mb-6 uppercase italic">ThÃ´ng Tin Äáº·t CÃ y</h2>
            <div class="space-y-4 text-left">
                <div><label class="text-[11px] font-bold text-slate-400 ml-1 uppercase">TÃ i khoáº£n:</label><input id="order-user" placeholder="VÃ­ dá»¥: bidaithan" class="input-auth mt-1 w-full"></div>
                <div><label class="text-[11px] font-bold text-slate-400 ml-1 uppercase">Máº­t kháº©u:</label><input id="order-pass" type="password" placeholder="VÃ­ dá»¥: 1234566" class="input-auth mt-1 w-full"></div>
                <div><label class="text-[11px] font-bold text-slate-400 ml-1 uppercase">Ghi chÃº cho Admin:</label><textarea id="order-note" placeholder="TÃªn 3 trÃ² chÆ¡i gáº§n nháº¥t..." class="input-auth mt-1 h-20 resize-none w-full"></textarea></div>
            </div>
            <div class="grid grid-cols-2 gap-4 mt-8">
                <button onclick="document.getElementById('order-modal').style.display='none'" class="bg-slate-800 py-4 rounded-2xl font-black text-[10px] uppercase">Há»§y</button>
                <button id="confirm-buy-btn" class="bg-blue-600 py-4 rounded-2xl font-black text-[10px] uppercase">XÃ¡c Nháº­n</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA5wBS88oS54yLs0OfwDYDfDQeTjc6ccdM", authDomain: "shop-blox-fruit-trannghia.firebaseapp.com", projectId: "shop-blox-fruit-trannghia", storageBucket: "shop-blox-fruit-trannghia.firebasestorage.app", messagingSenderId: "703644575266", appId: "1:703644575266:web:b3a21bbbe4b2c466d38c7b" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(); const auth = firebase.auth();
        
        // DÃ¡n LINK DISCORD WEBHOOK cá»§a báº¡n vÃ o Ä‘Ã¢y
        const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1465634875586379941/mhGERGnEIzdciQElWP9cr4MCwjsvGWDks3UXyhgKZCce5g78DbVnMXnnDLOlzBoERkJi";

        // Báº£ng tÃ­nh chiáº¿t kháº¥u (thuáº¿) cho tháº» cÃ o
        const thueMap = {
            "10000": 9210, "20000": 16900, "30000": 25350, "50000": 43250,
            "100000": 86500, "200000": 173000, "300000": 259500, "500000": 432500,
            "1000000": 865000
        };

        // Dá»¯ liá»‡u sáº£n pháº©m (báº¡n cÃ³ thá»ƒ thÃªm/sá»­a link áº£nh vÃ  tÃªn váº­t pháº©m á»Ÿ Ä‘Ã¢y)
        const fruits = [
            {n:"Kitsune VÄ©nh Viá»…n", p:690000, img:"https://bloxfruits.net/wp-content/uploads/2023/12/kitsune.webp"},
            {n:"Dragon VÄ©nh Viá»…n", p:750000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/dragon.webp"},
            {n:"Leopard VÄ©nh Viá»…n", p:562000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/leopard.webp"},
            {n:"Dough VÄ©nh Viá»…n", p:444000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/dough.webp"},
            {n:"Buddha VÄ©nh Viá»…n", p:250000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/buddha.webp"},
            {n:"Portal VÄ©nh Viá»…n", p:250000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/portal.webp"},
            {n:"T-Rex VÄ©nh Viá»…n", p:420000, img:"https://bloxfruits.net/wp-content/uploads/2023/12/trex.webp"},
            {n:"Mammoth VÄ©nh Viá»…n", p:420000, img:"https://bloxfruits.net/wp-content/uploads/2023/10/mammoth.webp"}
            // ThÃªm cÃ¡c trÃ¡i khÃ¡c vÃ o Ä‘Ã¢y
        ]; 
        const gamepasses = [
            {n:"Dark Blade", p:200000, img:"https://static.wikia.nocookie.net/blox-fruits/images/e/eb/Dark_Blade_Icon.png"},
            {n:"Fruit Notifier", p:370000, img:"https://static.wikia.nocookie.net/blox-fruits/images/1/1b/Fruit_Notifier.png"},
            {n:"1 Fruit Storage",p:50000, img:"https://static.wikia.nocookie.net/blox-fruits/images/d/d4/Fruit_Storage.png"},
            {n:"X2 Money", p:54000, img:"https://static.wikia.nocookie.net/blox-fruits/images/1/13/2x_Money.png"},
            {n:"X2 Mastery", p:54000, img:"https://static.wikia.nocookie.net/blox-fruits/images/9/91/2x_Mastery.png"},
            {n:"X2 Drop", p:40000, img:"https://static.wikia.nocookie.net/blox-fruits/images/1/17/2x_Boss_Drops.png"},
            {n:"Fast Boat", p:40000, img:"https://static.wikia.nocookie.net/blox-fruits/images/9/90/Fast_Boats.png"}
            // ThÃªm cÃ¡c gamepass khÃ¡c vÃ o Ä‘Ã¢y
        ];
        const caythue = [
            {n:"CÃ y Level 1-2800", p:20000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/leveling.webp"},
            {n:"Láº¥y VÃµ V2 (Full ChiÃªu)",p:30000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/fightingstyles.webp"},
            {n:"Up Tá»™c V4 Full",p:50000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/race-v4.webp"},
            {n:"Láº¥y Song Kiáº¿m Oden", p:50000, img:"https://bloxfruits.net/wp-content/uploads/2023/04/swords.webp"}
            // ThÃªm cÃ¡c dá»‹ch vá»¥ cÃ y thuÃª khÃ¡c vÃ o Ä‘Ã¢y
        ];

        // Gá»­i tin nháº¯n vá» Discord
        async function sendDiscord(msg) { 
            if(!DISCORD_WEBHOOK.includes("discord.com")) return console.warn("Missing Discord Webhook URL!");
            await fetch(DISCORD_WEBHOOK, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ content: msg }) });
        }

        // Hiá»‡n sáº£n pháº©m ra giao diá»‡n
        function renderProducts() {
            const fList = document.getElementById('fruit-list'); fList.innerHTML = '';
            fruits.forEach(i => fList.innerHTML += `<div class="card"><img src="${i.img}"><p class="text-[10px] font-bold text-white mb-1">${i.n}</p><p class="text-green-400 font-black text-xs mb-3">${i.p.toLocaleString()}Ä‘</p><button onclick="buy('${i.n}', ${i.p}, 'gift')" class="btn-buy">Mua Ngay</button></div>`);
            
            const gList = document.getElementById('gp-list'); gList.innerHTML = '';
            gamepasses.forEach(i => gList.innerHTML += `<div class="card"><img src="${i.img}"><p class="text-[10px] font-bold text-white mb-1">${i.n}</p><p class="text-green-400 font-black text-xs mb-3">${i.p.toLocaleString()}Ä‘</p><button onclick="buy('${i.n}', ${i.p}, 'gift')" class="btn-buy">Mua Ngay</button></div>`);

            const cList = document.getElementById('ct-list'); cList.innerHTML = '';
            caythue.forEach(i => cList.innerHTML += `<div class="card flex items-center p-4 text-left gap-4"><img src="${i.img}" style="width:70px; height:70px;"><div class="flex-1"><p class="font-black text-blue-400 text-xs">${i.n}</p><p class="text-lg font-black">${i.p.toLocaleString()}Ä‘</p></div><button onclick="buy('${i.n}', ${i.p}, 'acc')" class="bg-blue-600 px-4 py-3 rounded-xl font-black text-[10px] uppercase">Äáº·t CÃ y</button></div>`);
        }
        renderProducts(); // Gá»i hÃ m Ä‘á»ƒ hiá»‡n sáº£n pháº©m khi táº£i trang

        // Chuyá»ƒn Ä‘á»•i giá»¯a cÃ¡c Tab (TrÃ¡i, Gamepass, CÃ y thuÃª)
        function showTab(t) {
            ['fruit','gp','ct'].forEach(id => { 
                document.getElementById(id+'-list').style.display = 'none'; // áº¨n táº¥t cáº£
                document.getElementById('btn-'+id).className = 'tab-btn inactive-tab'; 
            });
            document.getElementById(t+'-list').style.display = 'grid'; // Chá»‰ hiá»‡n tab Ä‘Æ°á»£c chá»n
            document.getElementById('btn-'+t).className = 'tab-btn active-tab';
        }
        showTab('fruit'); // Máº·c Ä‘á»‹nh hiá»ƒn thá»‹ tab TrÃ¡i Ãc Quá»· khi táº£i trang

        let isL = true; // Biáº¿n tráº¡ng thÃ¡i Ä‘Äƒng nháº­p/Ä‘Äƒng kÃ½
        function openAuth() { document.getElementById('auth-modal').style.display='flex'; } // Má»Ÿ modal Ä‘Äƒng nháº­p
        
        // Xá»­ lÃ½ ÄÄƒng nháº­p/ÄÄƒng kÃ½
        async function handleAuth() {
            const user = document.getElementById('u').value.trim().toLowerCase();
            const pass = document.getElementById('p').value;
            if(user.length < 3 || pass.length < 6) return alert("TÃªn tÃ i khoáº£n tá»‘i thiá»ƒu 3 kÃ½ tá»±, máº­t kháº©u tá»‘i thiá»ƒu 6 kÃ½ tá»±!");
            const email = user + "@shopnghia.com"; 
            try {
                if(isL) { await auth.signInWithEmailAndPassword(email, pass); }
                else { 
                    const res = await auth.createUserWithEmailAndPassword(email, pass);
                    await db.ref('users/' + res.user.uid).set({ username: user, balance: 0 });
                }
                location.reload(); // Táº£i láº¡i trang sau khi thÃ nh cÃ´ng
            } catch(e) { alert("Lá»—i: " + e.message); }
        }

        // Theo dÃµi tráº¡ng thÃ¡i Ä‘Äƒng nháº­p Firebase
        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('auth-modal').style.display='none'; // áº¨n modal Ä‘Äƒng nháº­p
                db.ref('users/' + user.uid).on('value', s => {
                    document.getElementById('auth-buttons').style.display='none';
                    document.getElementById('user-info').style.display='flex';
                    document.getElementById('display-name').innerText = s.val().username;
                    document.getElementById('balance').innerText = s.val().balance.toLocaleString();
                    
                    // Cáº­p nháº­t ná»™i dung chuyá»ƒn khoáº£n QR khi ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p
                    document.getElementById('qr-note-text').innerText = `NAP ${s.val().username.toUpperCase()}`;
                });
            } else {
                document.getElementById('auth-buttons').style.display='block';
                document.getElementById('user-info').style.display='none';
                // Äáº·t láº¡i ná»™i dung QR khi chÆ°a Ä‘Äƒng nháº­p
                document.getElementById('qr-note-text').innerText = `NAP [TÃªn tÃ i khoáº£n cá»§a báº¡n]`;
            }
        });

        // Cáº­p nháº­t sá»‘ tiá»n thá»±c nháº­n khi chá»n má»‡nh giÃ¡ tháº»
        function updateRealAmount() {
            const val = document.getElementById('card-amount').value;
            const realVal = thueMap[val];
            document.getElementById('real-amount-text').innerText = `Thá»±c nháº­n: ${realVal.toLocaleString()}Ä‘`;
        }
        updateRealAmount(); // Gá»i láº§n Ä‘áº§u Ä‘á»ƒ hiá»‡n giÃ¡ trá»‹ máº·c Ä‘á»‹nh

        // Gá»­i tháº» cÃ o lÃªn há»‡ thá»‘ng
        async function guiThe() {
            if(!auth.currentUser) return openAuth();
            const t = document.getElementById('card-type').value;
            const a = document.getElementById('card-amount').value;
            const s = document.getElementById('card-seri').value;
            const p = document.getElementById('card-pin').value;
            const realAmount = thueMap[a]; 

            if(!s || !p) return alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ Sá»‘ Seri vÃ  MÃ£ tháº»!");

            const u = (await db.ref('users/' + auth.currentUser.uid + '/username').get()).val();
            
            // LÆ°u Ä‘Æ¡n tháº» vÃ o Firebase
            await db.ref('napthe/' + Date.now()).set({
                uid: auth.currentUser.uid,
                username: u,
                type: t,
                amount: parseInt(a),
                realAmount: realAmount, 
                seri: s,
                pin: p,
                status: 'pending' // Chá» duyá»‡t
            });

            // Gá»­i thÃ´ng bÃ¡o vá» Discord
            sendDiscord(`ğŸ’³ **THáºº Má»šI!**\nğŸ‘¤ KhÃ¡ch: ${u}\nğŸ’° Má»‡nh giÃ¡: ${parseInt(a).toLocaleString()}Ä‘\nğŸ”¥ Thá»±c nháº­n: ${realAmount.toLocaleString()}Ä‘\nLoáº¡i: ${t}\nSeri: ${s} | Pin: ${p}`);
            alert("Gá»­i tháº» thÃ nh cÃ´ng! Vui lÃ²ng chá» NghÄ©a duyá»‡t tháº».");
        }

        // BÃ¡o Ä‘Ã£ chuyá»ƒn khoáº£n QR (chá»‰ gá»­i Discord Ä‘á»ƒ NghÄ©a kiá»ƒm tra)
        async function notifyQRTransfer() {
            if(!auth.currentUser) return openAuth();
            const u = (await db.ref('users/' + auth.currentUser.uid + '/username').get()).val();
            sendDiscord(`âœ… **KHÃCH BÃO ÄÃƒ CHUYá»‚N KHOáº¢N QR!**\nğŸ‘¤ TÃªn tÃ i khoáº£n shop: ${u}\nNghÄ©a Æ¡i vÃ o app ngÃ¢n hÃ ng kiá»ƒm tra ngay nhÃ©!`);
            alert("ÄÃ£ gá»­i thÃ´ng bÃ¡o cho NghÄ©a. Vui lÃ²ng chá» NghÄ©a kiá»ƒm tra giao dá»‹ch vÃ  cá»™ng tiá»n vÃ o vÃ­.");
        }

        // HÃ m mua váº­t pháº©m / Ä‘áº·t cÃ y
        let currentProduct = null;
        async function buy(n, p, type) {
            if(!auth.currentUser) return openAuth();
            const ref = db.ref('users/' + auth.currentUser.uid);
            const s = await ref.get();
            if(s.val().balance < p) return alert("VÃ­ cá»§a báº¡n khÃ´ng Ä‘á»§ tiá»n! Vui lÃ²ng náº¡p thÃªm.");

            if(type === 'gift') { // Mua táº·ng TrÃ¡i/Gamepass
                let note = prompt("Nháº­p TÃªn NhÃ¢n Váº­t Roblox nháº­n quÃ :");
                if(note) {
                    await ref.update({ balance: s.val().balance - p });
                    sendDiscord(`ğŸ **ÄÆ N QUÃ€!**\nğŸ‘¤ KhÃ¡ch: ${s.val().username}\nğŸ MÃ³n: ${n}\nğŸ“ TÃªn nháº­n: ${note}\nğŸ’µ GiÃ¡: ${p.toLocaleString()}Ä‘`);
                    alert("Mua thÃ nh cÃ´ng! NghÄ©a sáº½ xá»­ lÃ½ Ä‘Æ¡n hÃ ng cá»§a báº¡n.");
                }
            } else { // Äáº·t CÃ y ThuÃª
                currentProduct = { n, p };
                document.getElementById('order-user').value = ''; // Reset form
                document.getElementById('order-pass').value = '';
                document.getElementById('order-note').value = '';
                document.getElementById('order-modal').style.display='flex';
                
                document.getElementById('confirm-buy-btn').onclick = async () => {
                    const uO = document.getElementById('order-user').value.trim();
                    const pO = document.getElementById('order-pass').value.trim();
                    const nO = document.getElementById('order-note').value.trim();
                    if(!uO || !pO) return alert("Vui lÃ²ng nháº­p tÃ i khoáº£n vÃ  máº­t kháº©u Roblox!");

                    await ref.update({ balance: s.val().balance - currentProduct.p });
                    sendDiscord(`âš”ï¸ **ÄÆ N CÃ€Y THUÃŠ!**\nğŸ‘¤ KhÃ¡ch: ${s.val().username}\nğŸ”¥ GÃ³i: ${currentProduct.n}\nğŸ” TK: ${uO} | MK: ${pO}\nğŸ“ Ghi chÃº: ${nO}\nğŸ’µ GiÃ¡: ${currentProduct.p.toLocaleString()}Ä‘`);
                    
                    document.getElementById('order-modal').style.display='none';
                    alert("Äáº·t cÃ y thÃ nh cÃ´ng! NghÄ©a sáº½ xá»­ lÃ½ Ä‘Æ¡n cá»§a báº¡n.");
                };
            }
        }
    </script>
</body>
</html>
